{"./":{"url":"./","title":"Introduction","keywords":"","body":"Hi there ðŸ‘‹ ðŸ”­ My name is Jane, an undergraduate student from the National University of Defense Technology. ðŸ‘€ My research interest includes Managed Runtime, Compiler, MLSys, and Large Language Models (LLM). ðŸ“« How to reach me: zexinjian@gmail.com "},"MLSys/GPUManagement/":{"url":"MLSys/GPUManagement/","title":"GPU Management","keywords":"","body":"GPU Management "},"MLSys/MLServing/":{"url":"MLSys/MLServing/","title":"MLServing","keywords":"","body":"MLServing SOSP24 - PowerInfer: Fast Large Language Model Serving with a Consumer-grade GPU "},"MLSys/MLServing/icml23-DejaVu.html":{"url":"MLSys/MLServing/icml23-DejaVu.html","title":"ICML23 - DejaVu","keywords":"","body":"ICML23 - DejaVu Deja Vu: Contextual Sparsity for Efficient LLMs at Inference Time ICML23ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ç¯‡æ–‡ç« ã€‚å®ƒçš„æ ¸å¿ƒæ–¹æ³•æ˜¯åœ¨æŽ¨ç†é˜¶æ®µï¼Œåˆ©ç”¨å½“å‰è¾“å…¥åŠ¨æ€åœ°é€‰æ‹©éƒ¨åˆ†ç½‘ç»œå‚æ•°æ¥è¿›è¡ŒæŽ¨ç†ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…¨å‚ã€‚æ‰€ä»¥å¯ä»¥å°†å…¶çœ‹ä½œæ˜¯ä¸€ç§\"åŠ¨æ€å‰ªæž\"çš„æ–¹æ³•ã€‚è‹¹æžœæœ€è¿‘æŽ¨å‡ºçš„LLM in flashç®—æ˜¯å¯¹è¯¥æ–¹æ³•çš„ç›´æŽ¥åº”ç”¨ï¼Œå¯è§DejaVuæœªæ¥åœ¨ç§»åŠ¨ç«¯éƒ¨ç½²LLMçš„æ½œåŠ›ä¼šéžå¸¸å·¨å¤§ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ–¹æ¡ˆå¾ˆç®€å•ã€‚ æé«˜LLMçš„æŽ¨ç†é€Ÿåº¦åœ¨ç®—åŠ›æžä¸ºæœ‰é™çš„æƒ…å†µä¸‹å…·æœ‰éžå¸¸é‡è¦çš„çŽ°å®žæ„ä¹‰ã€‚å‰ªæžä½œä¸ºä¸€ç§é‡è¦çš„æ¨¡åž‹è½»é‡åŒ–æ‰‹æ®µï¼Œå®ƒçš„æ ¸å¿ƒå‡è®¾æ˜¯æ¨¡åž‹å‚æ•°çš„ç¨€ç–æ€§ï¼šå¯ä»¥å‰ªæŽ‰æŸäº›ä¸é‡è¦çš„å‚æ•°æ¥å‡å°‘æ¨¡åž‹å‚æ•°é‡ï¼Œå¹¶å°½å¯èƒ½ç»´æŒæ¨¡åž‹çš„è¡¨çŽ°ã€‚ åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ç‰¹å®šçš„å‰ªæžç®—æ³•ä»Žä¸€ä¸ªè¾ƒå¤§çš„LLMå‡ºå‘ (å‡è®¾ä¸ºæ¨¡åž‹A)ï¼Œé€šè¿‡å‰ªæžå¾—åˆ°ä¸€ä¸ªè¾ƒå°çš„LLM (å‡è®¾ä¸ºæ¨¡åž‹B)ã€‚åœ¨æŽ¨ç†é˜¶æ®µï¼Œä½¿ç”¨æ¨¡åž‹Bå®Œæˆè®¡ç®—ï¼Œè¿™ä¸ªç®€å•è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨æŽ¨ç†é˜¶æ®µï¼Œå¯¹äºŽä»»ä½•è¾“å…¥Xæ¥è¯´ï¼ŒLLM Bçš„äº§ç”Ÿè¿‡ç¨‹ä¸Žå®ƒæ— å…³ã€‚æ‰€ä»¥å¯ä»¥æŠŠè¿™ç§å‰ªæžæ–¹æ³•ç§°ä¸º\"é™æ€å‰ªæž\"ï¼Œè€Œé™æ€å‰ªæžåŸºäºŽçš„ç¨€ç–æ€§å‡è®¾ç§°ä¸º\"é™æ€ç¨€ç–æ€§\"ã€‚ åœ¨DejaVuä¸­ï¼ŒLLM Bä¸Žè¾“å…¥Xç›¸å…³ã€‚æ‰€ä»¥å¯ä»¥æŠŠè¿™ç§å‰ªæžæ–¹æ³•ç§°ä¸º\"åŠ¨æ€å‰ªæž\"ï¼Œè€Œå®ƒåŸºäºŽçš„ç¨€ç–æ€§å‡è®¾ç§°ä¸º\"åŠ¨æ€ç¨€ç–æ€§\"ã€‚åœ¨åŽŸè®ºæ–‡ä¸­ï¼Œä½¿ç”¨çš„è¯æ˜¯Contextual Sparsityã€‚Contextualå¼ºè°ƒçš„æ˜¯LLM Bçš„äº§ç”Ÿä¸Žè¾“å…¥Xæœ‰å…³ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸Šå›¾ä¸­ï¼ŒLLM Bçš„äº§ç”Ÿè¿‡ç¨‹å—è¾“å…¥Xçš„å½±å“ã€‚DejaVuè¦è§£å†³çš„æ ¸å¿ƒæ˜¯ï¼šå¦‚ä½•åŸºäºŽè¾“å…¥Xä»Žé¢„è®­ç»ƒå¥½çš„LLM Aä¸­å¿«é€Ÿäº§ç”ŸLLM Bã€‚ 1. Contextual Sparsity Contextual Sparsityçš„æœ¬è´¨æ˜¯å¼ºè°ƒå¯¹äºŽä¸€ä¸ªé¢„è®­ç»ƒå¥½çš„LLM Aï¼Œå®ƒçš„weightçš„é‡è¦æ€§ä¾èµ–äºŽè¾“å…¥Xã€‚ä¾‹å¦‚å¯¹äºŽä¸¤ä¸ªä¸åŒçš„è¾“å…¥X1å’ŒX2ï¼Œç»åŠ¨æ€å‰ªæžå¾—åˆ°çš„LLM Bæ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™å°±æ˜¯Contextualçš„å«ä¹‰ï¼Œå®ƒæŒ‡LLM Bä¾èµ–äºŽä¸Šä¸‹æ–‡ï¼Œè€Œä¸Šä¸‹æ–‡å°±æ˜¯æ¨¡åž‹çš„è¾“å…¥ã€‚ ä½†æ˜¯Contextual Sparsityæœ¬èº«åœ¨LLMä¸­å­˜åœ¨å—ï¼Ÿ åŽŸæ–‡éªŒè¯Contextual Sparsityçš„æ–¹æ³•å¾ˆç®€å•ã€‚é¦–å…ˆï¼Œä½¿ç”¨è¾“å…¥Xè¿›è¡Œä¸€æ¬¡å‰å‘æŽ¨ç†ï¼Œå¹¶è®°å½•è¾“å‡ºå…·æœ‰è¾ƒå¤§normçš„MHA (Multi-Head Attention)ä¸­çš„headå’ŒMLPä¸­çš„ç¥žç»å…ƒã€‚ å…·ä½“å®žçŽ°èµ·æ¥ä¹Ÿæ¯”è¾ƒå®¹æ˜“ã€‚ä¾‹å¦‚å¯¹äºŽMHAï¼Œå®ƒçš„æ¯ä¸€ä¸ªheadçš„è¾“å‡ºæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹è¿™ä¸ªè¾“å‡ºçŸ©é˜µè®¡ç®—å®ƒçš„L2 Normï¼Œç„¶åŽä»Žæ‰€æœ‰headä¸­æŒ‘é€‰å‡ºL2 Normæœ€å¤§çš„é‚£å‡ ä¸ªheadå³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸Šå›¾ç¤ºä¾‹ä¸­ï¼Œè¾“å…¥Xçš„åºåˆ—é•¿åº¦N=10ï¼Œç»´åº¦d=6ã€‚å‡è®¾MHAçš„headæ•°é‡ä¸º3ï¼Œé‚£ä¹ˆMHAçš„è¾“å‡ºå¯¹åº”äºŽä¸‰ä¸ªä¸åŒçš„headï¼Œå›¾ä¸­ç”±ä¸åŒé¢œè‰²è¡¨ç¤ºã€‚åªéœ€è®¡ç®—æ¯ä¸ªheadå¯¹åº”è¾“å‡º (ä¸åŒé¢œè‰²åŒºåŸŸ)çš„L2 Normï¼Œç„¶åŽæ‰¾å‡ºè¾ƒå¤§çš„headå³å¯ã€‚ å¯¹äºŽMLPï¼Œæœ‰ä¸€ç‚¹å°åŒºåˆ«ã€‚å¯¹æŸä¸ªç‰¹å®šçš„tokenï¼ŒMLPçš„è¾“å‡ºæ˜¯ä¸€ä¸ªå‘é‡ã€‚ä½†æ­¤æ—¶ä¸èƒ½è®¡ç®—æ•´ä¸ªå‘é‡çš„L2 Normï¼Œè€Œæ˜¯è¦çœ‹å“ªä¸€ä¸ªè¾“å‡ºç»´åº¦çš„L2 Normè¾ƒå¤§ã€‚è¿™æ˜¯å› ä¸ºæ•´ä¸ªå‘é‡æ˜¯ä¾é æ‰€æœ‰ç¥žç»å…ƒè®¡ç®—å¾—åˆ°çš„ï¼Œè€Œæ¯ä¸€ä¸ªç»´åº¦å¯¹åº”äºŽä¸€ä¸ªç¥žç»å…ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ MLPæ˜¯é€positionæ‰§è¡Œçš„ï¼Œæ‰€ä»¥å®ƒçš„ç‰©ç†æ„ä¹‰åº”è¯¥æŒ‰ç…§å›¾ä¸­çº¢è‰²æ¡†çš„å½¢å¼æ¥ç†è§£ï¼šæ¯ä¸€åˆ—æ˜¯è¾“å…¥ä¸­æ¯ä¸€åˆ— (token)çš„å˜æ¢ã€‚ä½†æ˜¯åœ¨å¯»æ‰¾æœ‰æ•ˆç¥žç»å…ƒæ—¶ï¼Œéœ€è¦æŒ‰ç…§è¡Œæ¥æŒ‘é€‰ã€‚æ¢è¨€ä¹‹ï¼Œéœ€è¦è®¡ç®—æ¯ä¸€è¡Œçš„L2 Normï¼Œç„¶åŽæŒ‘å‡ºå…·æœ‰è¾ƒå¤§Normçš„ç¥žç»å…ƒã€‚ åœ¨æ‰¾åˆ°å…·æœ‰è¾ƒå¤§Normçš„headå’Œç¥žç»å…ƒåŽï¼ŒåŽŸè®ºæ–‡ä¸­ä½¿ç”¨ç›¸åŒçš„è¾“å…¥Xå†ä¸€æ¬¡è¿›è¡Œå‰å‘æŽ¨ç†ï¼Œä½†æ­¤æ—¶ä»…ä½¿ç”¨æŒ‘é€‰å‡ºçš„éƒ¨åˆ†headå’ŒMLPä¸­çš„éƒ¨åˆ†ç¥žç»å…ƒå‚ä¸Žè®¡ç®—ã€‚åŽŸæ–‡ä¸­å‘çŽ°ï¼Œä»…ä½¿ç”¨æŒ‘é€‰å‡ºçš„éƒ¨åˆ†headå’Œç¥žç»å…ƒï¼Œå‡ ä¹Žä¸å½±å“æ¨¡åž‹çš„æ•ˆæžœã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡è¿™æ ·ä¸€ä¸ªç®€å•çš„å®žéªŒéªŒè¯ï¼Œä½œè€…ä»¬è®¤ä¸ºLLMä¸­å­˜åœ¨Contextual Sparsityï¼šLLMä¸­å­˜åœ¨ä¸Žè¾“å…¥å¼ºç›¸å…³çš„éƒ¨åˆ†é«˜æ•ˆå‚æ•°ã€‚ä»…ä½¿ç”¨è¿™äº›éƒ¨åˆ†å‚æ•°ï¼Œèƒ½å¾—åˆ°ä¸Žä½¿ç”¨å…¨å‚æ¨¡åž‹å‡ ä¹Žä¸€è‡´çš„è¡¨çŽ°ã€‚ å†å¼ºè°ƒä¸€æ¬¡ï¼Œä¸åŒè¾“å…¥Xå¯¹åº”çš„é«˜æ•ˆå‚æ•°éƒ¨åˆ†æ˜¯ä¸ä¸€è‡´çš„ã€‚è¿™åŒºåˆ«äºŽä¼ ç»Ÿå‰ªæžæ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç§°ä¸ºContextual Sparsityçš„åŽŸå› ã€‚ æ³¨ï¼šTransformerè®ºæ–‡ä¸­MHAçš„æ¯ä¸ªheadè¾“å‡ºæ˜¯é€šè¿‡æ‹¼æŽ¥æˆä¸€ä¸ªä¸Žè¾“å…¥å°ºå¯¸ä¸€è‡´çš„tensorï¼Œç„¶åŽå†æŽ¥å…¨è¿žå±‚åšå˜æ¢ã€‚è®ºæ–‡ä¸­å› ä¸ºéœ€è¦æŒ‘é€‰éƒ¨åˆ†headï¼Œæ‰€ä»¥MHAçš„æµç¨‹æœ‰ä¸€ç‚¹ç‚¹å°å˜åŒ–ï¼šæ¯ä¸ªheadçš„è¾“å‡ºä¼šå…ˆæŽ¥ä¸€ä¸ªå…¨è¿žå±‚æ¥å˜åŒ–ä¸ºä¸Žè¾“å…¥å°ºå¯¸ä¸€è‡´çš„tensorï¼›ç„¶åŽå¯¹æ‰€æœ‰headçš„è¾“å‡ºæ±‚å¹³å‡å’Œã€‚æ‰€ä»¥ä¸è®ºé€‰å¤šå°‘ä¸ªheadï¼ŒMHAçš„è¾“å‡ºå°ºå¯¸éƒ½æ˜¯ä¸€è‡´çš„ã€‚ å‰æ–‡æåˆ°ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—Attention headå’ŒMLPä¸­ç¥žç»å…ƒè¾“å‡ºçš„L2 Normæ¥æ‰¾åˆ°\"é«˜æ•ˆå‚æ•°\"ã€‚ä½†è¿™ä¸ªæ¯”ä¾‹å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»å°†æ‰€æœ‰çš„headçš„L2 Normå’Œæ‰€æœ‰MLPä¸­ç¥žç»å…ƒçš„L2 Norméƒ½è®¡ç®—å‡ºæ¥äº†ï¼Œé‚£ä¹ˆç©¶ç«Ÿé€‰topå¤šå°‘çš„headå’Œç¥žç»å…ƒä½œä¸º\"é«˜æ•ˆå‚æ•°\"ï¼Ÿ åŽŸæ–‡åŸºäºŽOPTæ¨¡åž‹çš„å®žéªŒç»“è®ºå¦‚ä¸‹ï¼š Attention headçš„ç¨€ç–çŽ‡çº¦ä¸º80%ï¼› MLPä¸­ç¥žç»å…ƒçš„ç¨€ç–çŽ‡çº¦ä¸º95%ã€‚ å³ï¼šåœ¨å®žé™…æŽ¨ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åªä½¿ç”¨çº¦20%çš„Attention headå’Œçº¦5%çš„MLPç¥žç»å…ƒï¼Œå°±èƒ½è¾¾åˆ°å’Œå…¨å‚æ¨¡åž‹å·®ä¸å¤šçš„æ•ˆæžœã€‚ 2. ç¨€ç–æ€§é¢„æµ‹ æƒ³è¦åˆ©ç”¨å‰æ–‡æåˆ°çš„ç¨€ç–æ€§æ¥åŠ å¿«æŽ¨ç†é€Ÿåº¦ï¼Œéœ€è¦æœ‰æ–¹æ³•æ¥æå‰å‡†ç¡®åœ°é¢„æµ‹å¯¹äºŽå½“å‰è¾“å…¥Xï¼Œå“ªäº›headå’Œå“ªäº›MLPä¸­çš„ç¥žç»å…ƒæ˜¯\"é«˜æ•ˆå‚æ•°\"ã€‚ è¿™é‡Œéœ€è¦ä¸¤ä¸ªæ¨¡åž‹æ¥åšé¢„æµ‹ã€‚ç¬¬ä¸€ä¸ªæ¨¡åž‹ç”¨æ¥é¢„æµ‹MHAä¸­å“ªäº›headæ˜¯\"é«˜æ•ˆçš„\"ï¼›ç¬¬äºŒä¸ªæ¨¡åž‹ç”¨æ¥é¢„æµ‹MLPä¸­å“ªäº›ç¥žç»å…ƒæ˜¯\"é«˜æ•ˆçš„\" (ç¥žç»å…ƒå®žé™…ä¸Šå¯¹åº”äºŽå‚æ•°çŸ©é˜µçš„æŸä¸€åˆ—æˆ–æŸä¸€è¡Œã€‚è‡³äºŽç©¶ç«Ÿæ˜¯åˆ—è¿˜æ˜¯è¡Œï¼Œä¾èµ–äºŽå¯¹å‚æ•°çŸ©é˜µçš„å®šä¹‰å½¢å¼)ã€‚ åœ¨DejaVuä¸­ï¼Œè¿™ä¸¤ä¸ªæ¨¡åž‹çš„å®žçŽ°éƒ½ä½¿ç”¨äº†ä¸€ä¸ªä¸¤å±‚MLPã€‚ ä»¥é¢„æµ‹Attentionçš„headç¼–å·ä¸ºä¾‹ï¼Œå‡è®¾headæ•°ä¸º256ï¼Œåªéœ€è¦å°†MLPçš„è¾“å‡ºå±‚çš„å¤§å°è®¾ä¸º256ï¼Œå¹¶ä¸ºæ¯ä¸€ä¸ªè¾“å‡ºä½¿ç”¨sigmoidæ¥åšä¸€ä¸ªäºŒåˆ†ç±»å³å¯ (\"é€‰æ‹©\"or\"ä¸é€‰æ‹©\")ã€‚ è®­ç»ƒæ•°æ®ä¾é ä¸€ä¸ªå®Œæ•´çš„ã€è®­ç»ƒå¥½çš„LLMæ¥äº§ç”Ÿã€‚åœ¨è¿™ä¸ªLLMçš„æŽ¨ç†è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡è®°å½•å®ƒçš„Attentionè¾“å…¥å’ŒAttentionè¾“å‡ºï¼Œå¹¶è®¡ç®—ä¸åŒheadçš„L2 Normï¼Œå†åŸºäºŽä¸€ä¸ªL2 Normçš„é˜ˆå€¼tå°†headåˆ†ä¸ºæ­£ä¾‹å’Œè´Ÿä¾‹ã€‚ é¢„æµ‹MLPä¸­éœ€è¦é€‰æ‹©çš„ç¥žç»å…ƒç¼–å·çš„æ€è·¯ä¸Žä¸Šè¿°åŸºæœ¬ä¸€è‡´ã€‚ ä¸‹é¢ä»¥ä¸€ä¸ªTransformeræ¨¡å—ä¸ºä¾‹ï¼Œæ¥è¯´æ˜Žä¸€ç§æœ´ç´ çš„å®žçŽ°æ–¹æ³•ã€‚ å‡è®¾å½“å‰çš„Transformeræ¨¡å—ä¸ºç½‘ç»œçš„ç¬¬$l$å±‚ï¼Œå®ƒå¯¹åº”çš„ä¸¤ä¸ªç¨€ç–æ€§é¢„æµ‹æ¨¡åž‹è®°ä¸º$\\text{SP}^{l}{A}$å’Œ$\\text{SP}^{l}{M}$ã€‚$\\text{SP}$æ˜¯Sparsity Predictorçš„ç¼©å†™ï¼›ä¸‹æ ‡$A$è¡¨ç¤ºAttentionï¼›ä¸‹æ ‡$M$è¡¨ç¤ºMLPï¼›ä¸Šæ ‡$l$è¡¨ç¤ºå½“å‰çš„ç½‘ç»œå±‚æ•°ã€‚ ç¬¦å·$\\text{SP}^{l}{A}$å’Œ$\\text{SP}^{l}{M}$æ„å‘³ç€ä¸åŒç½‘ç»œå±‚ä½¿ç”¨çš„ç¨€ç–æ€§é¢„æµ‹æ¨¡åž‹æ˜¯ä¸åŒçš„ã€‚ å‡è®¾å½“å‰çš„è¾“å…¥ä¸º$x$ï¼Œé¦–å…ˆä½¿ç”¨æ¨¡åž‹$\\text{SP}^{l}_{A}$é¢„æµ‹éœ€è¦é€‰æ‹©çš„headç¼–å·ï¼š $a=\\text{SP}_{A}^{l}(x)$ $a$å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªç´¢å¼•é›†åˆï¼Œè¡¨ç¤ºé€‰ä¸­çš„headç¼–å·ã€‚ $out_1=\\text{MHA}_a(x)$ $\\text{MHA}$çš„ä¸‹æ ‡$a$è¡¨ç¤ºMHAåªä½¿ç”¨äº†$a$ä¸­ç¼–å·æ‰€å¯¹åº”çš„headã€‚ $b=\\text{SP}_{M}^{l}(out_1)$ $b$å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªç´¢å¼•é›†åˆï¼Œè¡¨ç¤ºé€‰ä¸­çš„ç¥žç»å…ƒç¼–å·ã€‚ $out_2=\\text{MLP}_b(out_1)$ 3. é«˜æ•ˆå®žçŽ° åŸºäºŽMLPçš„ç¨€ç–æ€§é¢„æµ‹å¿…é¡»è¦å°½å¯èƒ½é«˜æ•ˆåœ°å®žçŽ°ï¼Œå¦åˆ™æ•´ä¸ªLLMçš„æŽ¨ç†æ—¶é—´å¯èƒ½ä¼šå› ä¸ºå¼•å…¥äº†é¢å¤–çš„MLPè€Œå˜å¾—æ›´æ…¢ã€‚ 3.1 å¹¶è¡ŒåŒ–ç¨€ç–é¢„æµ‹ å‡è®¾$x$ä¸ºå½“å‰å±‚$l$çš„è¾“å…¥ã€‚å¹¶è¡ŒåŒ–çš„æ–¹æ¡ˆæ˜¯ç›´æŽ¥ä½¿ç”¨$x$æ¥é¢„æµ‹$l+1$å±‚çš„headç¼–å·å’ŒMLPç¥žç»å…ƒç¼–å·ã€‚è¿™ç›¸å½“äºŽæ˜¯æå‰é¢„æµ‹ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šå¯¹ç¬¬$l$å±‚æ¥è¯´ï¼Œå®ƒå¯ä»¥åœ¨è®¡ç®—MHAå’ŒMLPçš„åŒæ—¶é¢„æµ‹ä¸‹ä¸€å±‚çš„headç¼–å·å’ŒMLPç¥žç»å…ƒç¼–å·ã€‚ å› æ­¤åŽŸæœ¬åªèƒ½ä¸²è¡Œæ‰§è¡Œçš„å››æ­¥æ“ä½œï¼Œå…¶ä¸­é¢„æµ‹ç¼–å·çš„ä¸¤æ­¥å¯ä»¥å’Œå‰©ä¸‹çš„ä¸¤æ­¥å¹¶è¡Œæ‰§è¡Œäº†ã€‚ ä½†æ˜¯ä¸ºä»€ä¹ˆèƒ½è¿™æ ·åšï¼ŸåŽŸæ–‡ç»™å‡ºçš„ç†ç”±æ˜¯ï¼šLLMä¸­tokençš„embeddingçš„å˜åŒ–æ˜¯éžå¸¸ç¼“æ…¢çš„ã€‚å› ä¸ºç¼“æ…¢ï¼Œæ‰€ä»¥æå‰ä¸€æ­¥åŽ»é¢„æµ‹ä¼¼ä¹Žä¹Ÿæ¯”è¾ƒåˆç†ã€‚ ä¸Šå›¾ä¸­çš„å·¦å›¾æ˜¯è¿žç»­çš„ä¸¤ä¸ªç½‘ç»œå±‚token embeddingä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚ä¸Šå›¾ä¸­çš„å³å›¾æ˜¯é—´éš”nå±‚çš„token embeddingä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚ä¸¤ä¸ªå›¾éžå¸¸ç›´è§‚ï¼ŒLLMä¸­tokençš„embeddingçš„å˜åŒ–ç¡®å®žéžå¸¸ç¼“æ…¢ã€‚å› æ­¤ï¼Œä½¿ç”¨å‰ä¸€å±‚çš„è¾“å…¥åŽ»æå‰é¢„æµ‹ä¸‹ä¸€å±‚çš„ä¸¤ä¸ªç¼–å·ï¼Œä¹Ÿå°±æ¯”è¾ƒåˆç†ã€‚ 3.2 Kernel Fusion åœ¨PyTorchä¸­å®žçŽ°æ–‡ä¸­çš„ç¨€ç–çŸ©é˜µä¹˜æ³•éœ€è¦å…ˆç”¨é¢„æµ‹çš„ç¼–å·ç´¢å¼•åŽ»ä»Žå‚æ•°çŸ©é˜µä¸­å–å¯¹åº”çš„å‚æ•°ï¼Œè¿™ä¼šå¯¼è‡´3æ¬¡I/Oï¼š è¯»å‚æ•°çŸ©é˜µWï¼› å–å®Œå¯¹åº”ç´¢å¼•åŽå†™å‚æ•°çŸ©é˜µW1ï¼› è¯»W1è¿›è¡ŒçŸ©é˜µä¹˜æ³•è®¡ç®—ã€‚ æ˜¾ç„¶å¯¹äºŽå½“ä¸‹çš„åœºæ™¯ï¼Œ2ã€3æ˜¯å¤šäºŽçš„ä¸¤æ­¥ã€‚ä½†åœ¨PyTorchæä¾›çš„ç®—å­ä¸­ï¼Œåªèƒ½è¿™æ ·åŽ»æ‰§è¡Œã€‚ æ‰€ä»¥å¾ˆç®€å•çš„ç­–ç•¥æ˜¯å•ç‹¬å†™ä¸€ä¸ªkernelï¼Œå°†1ã€2ã€3æ­¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿™æ ·I/Oåªæœ‰1æ¬¡ã€‚ "},"MLSys/MLServing/acl24-LLM_in_a_flash.html":{"url":"MLSys/MLServing/acl24-LLM_in_a_flash.html","title":"ACL24 - LLM in a flash","keywords":"","body":"ACL24 - LLM in a flash 1. Flash Memory and DRAM åœ¨ç§»åŠ¨ç«¯è®¾å¤‡ä¸­ (å¦‚æ‰‹æœº)ï¼ŒDRAMå¯ç†è§£ä¸º\"è¿è¡Œæ—¶å†…å­˜\"ï¼ŒFlash Memoryå¯ç†è§£ä¸º\"å­˜å‚¨ç©ºé—´\"ã€‚åšä¸€ä¸ªç®€å•çš„ç±»æ¯”ï¼Œåœ¨PCä¸­ï¼ŒDRAMå¯¹åº”äºŽå†…å­˜ï¼›Flash Memoryå¯¹åº”äºŽç¡¬ç›˜å­˜å‚¨ (æ³¨æ„ï¼šä»…ä»…æ˜¯å¯¹åº”äºŽï¼Œå®žçŽ°æ–¹æ¡ˆå¹¶ä¸ä¸€æ ·)ã€‚ åœ¨é€šå¸¸çš„LLMæŽ¨ç†é˜¶æ®µï¼ŒLLMéƒ½æ˜¯ç›´æŽ¥åŠ è½½åˆ°DRAMä¸­çš„ã€‚ä¸€ä¸ª7BåŠç²¾åº¦LLMï¼Œå®Œå…¨åŠ è½½è¿›DRAMæ‰€éœ€çš„å­˜å‚¨ç©ºé—´è¶…è¿‡14GBã€‚è€ƒè™‘åˆ°ç›®å‰ä¸»æµæ‰‹æœºçš„DRAMæœ€é«˜ä¹Ÿå°±16GBçš„æ°´å¹³ï¼Œåœ¨ç«¯ä¾§ç›´æŽ¥ä½¿ç”¨DRAMæ¥åŠ è½½7B LLMé¢ä¸´å·¨å¤§æŒ‘æˆ˜ã€‚ ä¸‹å›¾ç»™å‡ºäº†ä¸€ä¸ªç§»åŠ¨ç«¯æ ‡å‡†çš„å­˜å‚¨ç»“æž„ç¤ºæ„å›¾ã€‚ Flash Memoryçš„ç‰¹ç‚¹æ˜¯å¤§å­˜å‚¨ã€ä½Žå¸¦å®½ï¼›è€ŒDRAMçš„ç‰¹ç‚¹æ˜¯å°å­˜å‚¨ï¼Œé«˜å¸¦å®½ã€‚ çŽ°åœ¨çš„é—®é¢˜æ˜¯ï¼šæ¨¡åž‹å¤§å° > DRAMï¼Œæ‰€ä»¥æ— æ³•å°†æ¨¡åž‹å…¨éƒ¨åŠ è½½è¿›DRAMã€‚ è‹¹æžœçš„è§£å†³æ–¹æ¡ˆæ˜¯å°†LLMæ”¾åœ¨Flash Memoryä¸­ï¼Œåœ¨æ¯æ¬¡éœ€è¦è¿›è¡ŒæŽ¨ç†æ—¶ï¼Œä»…ä»…å°†éƒ¨åˆ†å¿…è¦å‚æ•°åŠ è½½åˆ°DRAMä¸­ã€‚ è‹¹æžœçš„æ•´ä¸ªæ–¹æ¡ˆé‡ç‚¹è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š å¦‚ä½•å¿«é€Ÿè¯†åˆ«å‡ºå“ªäº›æ¨¡åž‹å‚æ•°æ˜¯å¿…è¦çš„ï¼› è€ƒè™‘åˆ°ç”±Flash memoryåˆ°DRAMçš„å¸¦å®½è¾ƒä½Žï¼Œå¦‚ä½•åŠ å¿«ç”±Flash memoryåˆ°DRAMçš„ä¼ è¾“æ•ˆçŽ‡ã€‚ è®ºæ–‡ä¸­ä»Žä¸‰ä¸ªä¸åŒæ–¹é¢åšäº†å°è¯•ã€‚ 2. å‡å°‘æ•°æ®ä¼ è¾“é‡ 2.1 æ–¹æ³•1ï¼šSelective Persistence Strategy å¯¹äºŽå¸¸è§çš„LLMè€Œè¨€ï¼Œå®ƒçš„æ¨¡åž‹å‚æ•°ä¸»è¦ç”±Attentionå‚æ•°å’ŒMLPå‚æ•°ä¸¤éƒ¨åˆ†æž„æˆï¼Œå…¶ä¸­Attentionå‚æ•°å æ¯”çº¦ä¸º1/3ï¼ŒMLPå‚æ•°å æ¯”çº¦ä¸º2/3ã€‚é™¤æ­¤ï¼Œè¿˜æœ‰å‚æ•°é‡çº§å¯å¿½ç•¥ä¸è®¡çš„Embeddingå±‚çš„å‚æ•°ã€‚ å› ä¸ºAttentionå‚æ•°é‡ç›¸å¯¹è¾ƒå°‘ï¼Œæ‰€ä»¥è‹¹æžœçš„æ–¹æ¡ˆæ˜¯å°†Attentionå‚æ•°å’ŒEmbeddingå±‚çš„å‚æ•°ç›´æŽ¥åŠ è½½åˆ°DRAMä¸­ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„Selective Persistence Strategyï¼Œå…¶æ„ä¸ºï¼šæœ‰é€‰æ‹©æ€§åœ°æŠŠéƒ¨åˆ†å‚æ•°å¸¸é©»åœ¨DRAMä¸­ã€‚è€Œè¿™éƒ¨åˆ†å¸¸é©»çš„å‚æ•°å°±æ˜¯Attentionå‚æ•°å’ŒEmbeddingå‚æ•°ã€‚åŽŸå› æ˜¯å› ä¸ºå®ƒä»¬å æ¯”è¾ƒå°ã€‚ 2.2 æ–¹æ³•2ï¼šAnticipating ReLU Sparsity è¿™é‡Œä¸»è¦å€Ÿé‰´äº†DejaVuçš„æ€è·¯ï¼šMLPå±‚çš„è¾“å‡ºåªæœ‰ä¸åˆ°10%çš„å€¼æ˜¯æ¿€æ´»çŠ¶æ€ï¼Œä¸€èˆ¬æŠŠè¿™ç§çŽ°è±¡ç§°ä¸ºç¨€ç–æ€§ã€‚ç¨€ç–æ€§è¶Šå¼ºï¼Œåˆ™éžæ¿€æ´»çŠ¶æ€çš„å€¼å°±è¶Šå¤šã€‚ è¦æ³¨æ„ï¼Œæ­¤å¤„çš„ç¨€ç–æ€§ä¸€èˆ¬ç§°ä¸º\"Contextual Sparsity\"ã€‚å³MLPå±‚çš„å“ªäº›ç¥žç»å…ƒä¼šæ¿€æ´»ï¼Œä¸Žå½“å‰çš„è¾“å…¥ç›¸å…³ã€‚ è‹¹æžœç…§æ¬äº†DejaVuçš„æ–¹æ³•ï¼Œä½¿ç”¨ä¸€ä¸ªä¸¤å±‚MLPæ¥é¢„æµ‹å“ªäº›ç¥žç»å…ƒä¼šæ¿€æ´»ã€‚æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå‡è®¾ç¥žç»å…ƒä¸ªæ•°ä¸º4096ï¼Œåªéœ€è¦å°†MLPçš„è¾“å‡ºå±‚çš„å¤§å°è®¾ä¸º4096ï¼Œå¹¶ä¸ºæ¯ä¸€ä¸ªè¾“å‡ºä½¿ç”¨sigmoidæ¥åšä¸€ä¸ªäºŒåˆ†ç±»å³å¯ (\"é€‰æ‹©\"or\"ä¸é€‰æ‹©\")ã€‚ æ³¨æ„ï¼š ä¸åŒTransformerå±‚ä½¿ç”¨çš„é¢„æµ‹æ¨¡åž‹ä¸åŒï¼› åŒä¸€ä¸ªTransformerå±‚ä¸­çš„MLPä¸€èˆ¬æœ‰ä¸¤å±‚ï¼Œå®ƒä»¬çš„æ¿€æ´»ç¥žç»å…ƒå§‹ç»ˆä¿æŒç›¸åŒã€‚ åœ¨èƒ½å¤Ÿå‡†ç¡®é¢„æµ‹çš„å‰æä¸‹ï¼Œæ¯æ¬¡åœ¨æŽ¨ç†æ—¶åŠ¨æ€åŠ è½½é¢„æµ‹ä¸ºæ¿€æ´»ç¥žç»å…ƒå¯¹åº”çš„å‚æ•°å³å¯ã€‚ 2.3 æ–¹æ³•3ï¼šSliding Window æ ¹æ®2.2å°èŠ‚ä¸­ä»‹ç»çš„ç¨€ç–æ€§å¯çŸ¥ï¼Œåœ¨æ¯ä¸€æ¬¡LLMè¿›è¡Œå‰å‘æŽ¨ç†æ—¶ï¼Œå®ƒéƒ½éœ€è¦ä½¿ç”¨æ¨¡åž‹é¢„æµ‹æ¯ä¸€ä¸ªMLPå±‚ä¸­æ¿€æ´»ç¥žç»å…ƒçš„ç¼–å·ï¼Œå¹¶å°†æ‰€éœ€çš„ç¥žç»å…ƒæ‰€å¯¹åº”çš„æƒé‡ç”±Flash memoryåŠ è½½åˆ°DRAMä¸­ã€‚ å› ä¸ºLLMçš„æŽ¨ç†é˜¶æ®µæ˜¯é€tokenè¿›è¡Œçš„ï¼Œè¿™æ„å‘³ç€åœ¨ç”Ÿæˆä¸åŒtokençš„æ—¶å€™ï¼Œéœ€è¦åŠ è½½åˆ°DRAMä¸­çš„MLPçš„å‚æ•°ä¹Ÿä¸åŒã€‚ ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜Žè¿™ä¸ªåŸºç¡€æ¦‚å¿µï¼Œåªè€ƒè™‘ç¬¬$l$å±‚çš„Transformeræ¨¡å—ã€‚åœ¨å¤„ç†å½“å‰token $x_1$æ—¶ï¼Œè¯¥å±‚ä½¿ç”¨æ¨¡åž‹$P^l$é¢„æµ‹MLPä¼šæ¿€æ´»çš„ç¥žç»å…ƒç¼–å·ï¼Œå‡è®¾ä¸º$\\lbrace 0, 1, 3, 5 \\rbrace$ï¼Œå¹¶å°†å…¶å¯¹åº”çš„å‚æ•°$W_l^1$ä»ŽFlash memoryåŠ è½½åˆ°DRAMä¸­ï¼Œç„¶åŽè¿›è¡ŒæŽ¨ç†ã€‚ åœ¨å¤„ç†ä¸‹ä¸€ä¸ªtoken $x_2$æ—¶ï¼Œå°†$W_l^1$ä»ŽDRAMä¸­åˆ é™¤ï¼Œå†ä½¿ç”¨æ¨¡åž‹$P^l$é¢„æµ‹MLPä¼šæ¿€æ´»çš„ç¥žç»å…ƒç¼–å·ï¼Œå‡è®¾ä¸º$\\lbrace 0, 2, 3, 6 \\rbrace$ï¼Œå¹¶å°†å…¶å¯¹åº”çš„å‚æ•°$W_l^2$ä»ŽFlash memoryåŠ è½½åˆ°DRAMä¸­ï¼Œç„¶åŽè¿›è¡ŒæŽ¨ç†ã€‚ æ³¨æ„åˆ°åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¸¤æ¬¡å‰å‘æŽ¨ç†æ—¶ï¼Œç¬¬$l$å±‚çš„Transformerç»“æž„ä¸­MLPæœ‰éƒ¨åˆ†è¢«é¢„æµ‹ä¸ºæ¿€æ´»çš„ç¥žç»å…ƒæ˜¯é‡å çš„ï¼š$\\lbrace 0, 3 \\rbrace$ã€‚æ‰€ä»¥å®žé™…ä¸Šåœ¨è¿›è¡Œç¬¬äºŒæ¬¡å‰å‘æŽ¨ç†æ—¶ï¼Œæ²¡æœ‰å¿…è¦æŠŠ$W_l^1$å®Œå…¨ä»ŽDRAMä¸­åˆ é™¤ï¼Œè€Œæ˜¯å°†å…¶ä¸­ç¼–å·ä¸º$\\lbrace 1, 5 \\rbrace$ç¥žç»å…ƒå¯¹åº”çš„å‚æ•°åˆ é™¤ï¼Œå†å°†ç¼–å·ä¸º$\\lbrace 2, 6 \\rbraceçš„ç¥žç»å…ƒå¯¹åº”çš„å‚æ•°è¯»å…¥å³å¯ã€‚è¿™æ ·å¯ä»¥å‡å°‘I/Oçš„æ€»å¼€é”€ã€‚ è¿™å°±æ˜¯Sliding Windowçš„æ ¸å¿ƒæ€æƒ³ï¼šä¿ç•™å¤„ç†è¿‡åŽ»kä¸ªtokenæ—¶çš„æ¿€æ´»ç¥žç»å…ƒæ‰€å¯¹åº”çš„å‚æ•°åœ¨DRAMä¸­ï¼Œå¹¶åœ¨å¤„ç†å½“å‰tokenæ—¶åªå¯¹ï¼š éƒ¨åˆ†å¤šä½™çš„å‚æ•°è¿›è¡Œåˆ é™¤ï¼› ç¼ºå°‘çš„å‚æ•°è¿›è¡ŒåŠ è½½ã€‚ Sliding Windowçš„æ ¸å¿ƒå‡è®¾æ˜¯LLMåœ¨å¤„ç†ç›¸é‚»tokenæ—¶äº§ç”Ÿçš„ç¨€ç–æ€§å…·æœ‰ç›¸ä¼¼æ€§ã€‚ 3. æé«˜ä¼ è¾“åžåé‡ 3.1 Bundling Columns and Rows é€šå¸¸LLMä¸­çš„MLPå±‚åŒ…å«ä¸¤ä¸ªå…¨è¿žå±‚ã€‚åœ¨å¿½ç•¥æ¿€æ´»å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªå…¨è¿žå±‚å¯ä»¥å†™ä¸ºï¼š $y=xW_1W_2^T$ï¼Œå…¶ä¸­è¾“å…¥$x \\in \\R^{1 \\times d},W_1,W_2 \\in \\R^{d \\times 1d}$ï¼Œ$d$æ˜¯ç»´åº¦ã€‚ åœ¨2.2å°èŠ‚ä¸­æåˆ°ï¼Œç¨€ç–æ€§é¢„æµ‹æ˜¯å¯¹MLPä¸­ä¸¤ä¸ªå…¨è¿žå±‚åŒæ—¶è¿›è¡Œçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœæˆ‘ä»¬é¢„æµ‹ç»“æžœæ˜¯ç¬¬ä¸€ä¸ªå…¨è¿žå±‚ä¸­0å·ç¥žç»å…ƒä¸ä¼šè¢«æ¿€æ´»ï¼Œé‚£ä¹ˆè¯¥é¢„æµ‹ç»“æžœåŒæ ·ä¹Ÿé€‚ç”¨äºŽç¬¬äºŒä¸ªå…¨è¿žå±‚ï¼šç¬¬äºŒä¸ªå…¨è¿žå±‚çš„0å·ç¥žç»å…ƒä¹Ÿä¸ä¼šè¢«æ¿€æ´»ã€‚ å¯¹äºŽç¬¬ä¸€ä¸ªå…¨è¿žå±‚çš„å‚æ•°çŸ©é˜µ$W_1$ï¼Œç¬¬iä¸ªç¥žç»å…ƒå¯¹åº”äºŽå®ƒçš„ç¬¬iåˆ—ï¼›å¯¹äºŽç¬¬äºŒä¸ªå…¨è¿žå±‚çš„å‚æ•°çŸ©é˜µ$W_2^T$ï¼Œç¬¬iä¸ªç¥žç»å…ƒå¯¹åº”äºŽå®ƒçš„ç¬¬iè¡Œã€‚ å½“ç¬¬iä¸ªç¥žç»å…ƒè¢«é¢„æµ‹ä¸ºæ¿€æ´»æ—¶ï¼Œéœ€è¦åŒæ—¶è¯»å–$W_1$çš„ç¬¬iåˆ—å’Œ$W_2^T$çš„ç¬¬iè¡Œã€‚æ‰€ä»¥ä¸ºäº†æé«˜è¯»å–é€Ÿåº¦ï¼Œå¯ä»¥å°†$W_1$çš„æ¯ä¸€åˆ—åˆ—å’Œ$W_2^T$çš„å¯¹åº”è¡Œæ‹¼æŽ¥èµ·æ¥å­˜å‚¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3.2 Bundling Based on Co-activation è¿™æ˜¯ä¸€ä¸ªåŽŸæ–‡å°è¯•è¿‡ï¼Œä½†è¢«éªŒè¯ä¸ºæ— æ•ˆçš„ç­–ç•¥ã€‚ åŽŸæ–‡ä¸­çŒœæµ‹æŸäº›ç¥žç»å…ƒä¹‹é—´å¯èƒ½å­˜åœ¨ä¸€äº›ç´§å¯†è”ç³»ã€‚æ¯”å¦‚å¯¹äºŽä¸¤ä¸ªç¥žç»å…ƒaå’Œbï¼Œå½“aæ¿€æ´»æ—¶ï¼Œbä¹Ÿä¼šæ¿€æ´» (æˆ–è€…å½“bæ¿€æ´»æ—¶ï¼Œaä¹Ÿä¼šæ¿€æ´»)ã€‚ å› æ­¤å¯ä»¥é€šè¿‡åˆ†æžæ¥æ‰¾åˆ°æ¯ä¸ªç¥žç»å…ƒçš„\"closest friend\" (ä¸Žè¯¥ç¥žç»å…ƒåŒæ—¶æ¿€æ´»é¢‘çŽ‡æœ€é«˜çš„å…¶å®ƒæŸä¸ªç¥žç»å…ƒ)ã€‚ç„¶åŽåœ¨å­˜å‚¨Flash memoryä¸­å­˜å‚¨æ—¶ï¼Œä¹Ÿå°†å®ƒä»¬çš„å‚æ•°æ‹¼æŽ¥å­˜åœ¨ä¸€èµ·ã€‚è¿™æ ·çš„è¯»å–æ•ˆçŽ‡æ›´é«˜ã€‚ ä½†è¯¥æ–¹æ³•ä¹‹æ‰€ä»¥æ— æ•ˆï¼Œä¸»è¦åŽŸå› æ˜¯å¯èƒ½ä¼šå­˜åœ¨æŸä¸ªç¥žç»å…ƒiï¼Œå®ƒæ˜¯å…¶å®ƒå¾ˆå¤šç¥žç»å…ƒçš„\"closest friend\"ã€‚è¿™æ ·å¯¼è‡´çš„é—®é¢˜åˆ™æ˜¯ç¥žç»å…ƒiè¢«é¢å¤–ä¼ è¾“äº†å¤ªå¤šæ¬¡ï¼Œå¯¼è‡´å®žé™…çš„I/Oæˆæœ¬å¢žåŠ äº†ã€‚ 4. Optimized Data Management in DRAM è™½ç„¶DRAMçš„æ•°æ®è¯»å–é€Ÿåº¦æ¯”Flash memoryå¿«å¾ˆå¤šï¼Œä½†å½“éœ€è¦å¯¹å…¶ä¸­æ•°æ®è¿›è¡Œå¤§é‡ã€é«˜é¢‘è¯»å†™æ—¶ï¼Œå®ƒçš„æ—¶è€—ä»ç„¶ä¸å¯å¿½ç•¥ã€‚åœ¨æœ¬æ–‡ä»‹ç»çš„å†…å®¹ä¸­ï¼Œå¯¹DRAMçš„è¯»å†™ä¸»è¦å‘ç”Ÿåœ¨å¯¹MLPå±‚ä¸­æ‰€éœ€ç¥žç»å…ƒå¯¹åº”å‚æ•°çš„åˆ é™¤ä¸Žæ–°å¢žã€‚ ä¸ºæ­¤ï¼Œè®ºæ–‡ä¸­è®¾è®¡äº†ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æž„æ¥å¯¹DRAMä¸­çš„æ•°æ®åšç²¾ç»†åŒ–ç®¡ç†ã€‚è¯¥æ•°æ®ç»“æž„çš„æ ¸å¿ƒå˜é‡å¦‚ä¸‹ï¼š Matrixï¼šæŒ‰ç…§\"Bundling Columns and Rows\"çš„æ–¹æ³•å­˜å‚¨æ¿€æ´»ç¥žç»å…ƒæ‰€å¯¹åº”çš„å‚æ•°ï¼› biasï¼šæ¿€æ´»ç¥žç»å…ƒæ‰€å¯¹åº”çš„biaså‚æ•°ï¼› num_usedï¼šæ¿€æ´»ç¥žç»å…ƒçš„ä¸ªæ•°ï¼› last_k_activeï¼šè¿‡åŽ»kä¸ªtokenæ‰€å¯¹åº”çš„æ¿€æ´»ç¥žç»å…ƒç¼–å·ï¼› Pointerï¼šå½“å‰è¡Œå‚æ•°å¯¹åº”çš„ç¥žç»å…ƒç¼–å·ã€‚ ä»¥ä¸Šå›¾ä¸­æœ€å·¦å›¾ä¸ºä¾‹ã€‚å›¾ä¸­çŸ©é˜µçš„æ¯ä¸€è¡Œæ˜¯ç‰¹å®šç¥žç»å…ƒ (Pointerå¯¹åº”çš„ç¼–å·)çš„ä¸¤ä¸ªå…¨è¿žå±‚å‚æ•°çš„æ‹¼æŽ¥å‘é‡ã€‚å¯¹äºŽç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªTransformerå±‚ä¸­çš„MLPï¼Œä¼šé¢„å…ˆåˆ†é…ä¸€ä¸ªå¤§å°ä¸º$R_i \\times 2d$çš„çŸ©é˜µã€‚$R_i$è¡¨ç¤ºé¢„åˆ†é…çš„è¡Œæ•°ï¼Œå®ƒè¡¨ç¤ºé¢„ä¼°çš„æ¿€æ´»ç¥žç»å…ƒæœ€å¤§å€¼ï¼Œé å®žéªŒå¾—åˆ°ã€‚$d$æ˜¯å…¨è¿žå±‚çš„ç»´åº¦ï¼›$2d$æ˜¯å› ä¸ºæ‹¼æŽ¥äº†ä¸¤ä¸ªå…¨è¿žå±‚çš„å‚æ•°ã€‚ é€šè¿‡é¢„åˆ†é…ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—´ï¼Œå¯ä»¥é¿å…å› åå¤åˆ†é…è€Œå¯¼è‡´çš„é¢å¤–å¼€é”€ã€‚ è¯¥çŸ©é˜µä¸­çš„è¡Œå¯¹åº”çš„æ˜¯å½“å‰å­˜å‚¨åœ¨DRAMä¸­æ¿€æ´»ç¥žç»å…ƒçš„å‚æ•°ã€‚å‰æ–‡æåˆ°ï¼Œå½“å¤„ç†æ–°çš„tokenæ—¶ï¼Œéœ€è¦å°†ä¸ä¼šè¢«æ¿€æ´»çš„ç¥žç»å…ƒåˆ é™¤ï¼Œå¹¶æ·»åŠ æ–°çš„ä¼šè¢«æ¿€æ´»çš„ç¥žç»å…ƒã€‚æ‰€ä»¥æœ€é‡è¦çš„ä¸¤ä¸ªæ“ä½œæ˜¯\"åˆ é™¤\"å’Œ\"æ–°å¢ž\"ã€‚ å½“éœ€è¦åˆ é™¤æŸä¸ªç¥žç»å…ƒæ—¶ï¼Œåªéœ€å°†num_rowsçš„æ•°é‡å‡1ï¼Œå¹¶å°†æœ€åŽä¸€è¡ŒCopyè‡³è¢«åˆ é™¤è¡Œï¼Œç»“æžœå¦‚å›¾4çš„ä¸­å›¾æ‰€ç¤ºã€‚è™šçº¿æ¡†è¡¨ç¤ºå½“å‰æœ‰æ•ˆçš„æ•°æ®ï¼› å½“éœ€è¦\"æ–°å¢ž\"æ—¶ï¼Œç›´æŽ¥å°†å…¶å¯¹åº”çš„å‚æ•°ç”±Flash memoryä¸­copyè‡³è¯¥çŸ©é˜µä¸­å³å¯ï¼Œæ— éœ€é¢å¤–åˆ†é…å­˜å‚¨ç©ºé—´ã€‚ 5. å®žéªŒç»“æžœ è‹¹æžœè¿™ç¯‡paperçš„ä¸»è¦å…³æ³¨ç‚¹åœ¨äºŽï¼šè®©LLMåœ¨è¿è¡Œæ—¶å†…å­˜å—é™çš„æƒ…å†µä¸‹èƒ½é«˜æ•ˆåœ°è·‘èµ·æ¥ã€‚æ‰€ä»¥è®ºæ–‡çš„å®žéªŒä¸»è¦å¯¹æ¯”äº†å„ç§æƒ…å†µä¸‹I/Oå¯¼è‡´çš„æ—¶è€—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ "},"MLSys/MLServing/sosp24-PowerInfer.html":{"url":"MLSys/MLServing/sosp24-PowerInfer.html","title":"SOSP24 - PowerInfer","keywords":"","body":"SOSP24 - PowerInfer PowerInfer: Fast Large Language Model Serving with a Consumer-grade GPU 1. èƒŒæ™¯ å¤§è¯­è¨€æ¨¡åž‹å› å…¶æ™ºåŠ›æ°´å¹³è¶Šæ¥è¶Šé«˜è€Œå¤‡å—å…³æ³¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ä»£ç ç”Ÿæˆã€AI Agentç­‰é¢†åŸŸå¾—åˆ°è¶Šæ¥è¶Šå¤šçš„åº”ç”¨ã€‚ç„¶è€Œï¼ŒLLMsç”±äºŽå…¶è¾ƒå¤§çš„å‚æ•°é‡ç›®å‰ä¸»è¦éƒ¨ç½²åœ¨é…å¤‡æœ‰é«˜ç«¯ä¸“ç”¨GPUæœåŠ¡å™¨çš„æ•°æ®ä¸­å¿ƒä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºŽæ•°æ®éšç§ã€é™ä½ŽæŽ¨ç†æˆæœ¬ç­‰éœ€æ±‚çš„æŽ¨åŠ¨ï¼Œåœ¨æœ¬åœ°å¹³å°ä¸Šéƒ¨ç½²LLMsçš„è¶‹åŠ¿æ­£åœ¨å…´èµ·ï¼Œç‰¹åˆ«æ˜¯åœ¨é…å¤‡æ¶ˆè´¹çº§GPUçš„ä¸ªäººç”µè„‘ä¸Šã€‚ 2. é—®é¢˜ åœ¨æ¶ˆè´¹çº§GPUä¸Šéƒ¨ç½²LLMsé¢ä¸´ç€å·¨å¤§æŒ‘æˆ˜ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºŽå…¶åºžå¤§çš„æ˜¾å­˜éœ€æ±‚ã€‚å½“æ¨¡åž‹å‚æ•°å¯¹æ˜¾å­˜çš„éœ€æ±‚è¶…å‡ºGPUæ˜¾å­˜æ—¶ï¼ŒçŽ°æœ‰çš„å‚æ•°å¸è½½æ–¹æ³•éƒ½ä¼šå¼•å…¥æ˜¾è‘—çš„é€Ÿåº¦ä¸‹é™é—®é¢˜ã€‚æœ¬æ–‡è®¤ä¸ºLLMæŽ¨ç†ä¸­å†…å­˜é—®é¢˜çš„å…³é”®åŽŸå› æ˜¯ç¡¬ä»¶æž¶æž„ä¸ŽLLMæŽ¨ç†ç‰¹æ€§ä¹‹é—´çš„å±€éƒ¨æ€§ä¸åŒ¹é…ã€‚å½“å‰çš„ç¡¬ä»¶æž¶æž„è®¾è®¡äº†ä¸€ä¸ªé’ˆå¯¹æ•°æ®å±€éƒ¨æ€§ä¼˜åŒ–çš„å†…å­˜å±‚æ¬¡ç»“æž„ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå°çš„ã€é¢‘ç¹è®¿é—®çš„å·¥ä½œé›†åº”è¯¥å­˜å‚¨åœ¨GPUä¸­ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ›´å¤§çš„ã€è®¿é—®é¢‘çŽ‡è¾ƒä½Žçš„æ•°æ®æ›´é€‚åˆå­˜å‚¨åœ¨CPUä¸­ã€‚ç„¶è€Œï¼Œæ¯æ¬¡LLMæŽ¨ç†è¿­ä»£éƒ½éœ€è¦è®¿é—®æ•´ä¸ªå‚æ•°é›†ï¼Œå…¶æ€»å¤§å°å¤ªå¤§è€Œæ— æ³•è£…å…¥å•ä¸ªGPUï¼Œå› æ­¤æ²¡æœ‰è¡¨çŽ°å‡ºä»»ä½•å±€éƒ¨æ€§ï¼Œä»Žè€Œé˜»ç¢äº†é«˜æ•ˆçš„å±€éƒ¨æ€§åˆ©ç”¨ã€‚ 3. è§‚å¯Ÿ LLMä¸­çš„ç¥žç»å…ƒæ¿€æ´»éµå¾ªå¹‚å¾‹åˆ†å¸ƒï¼šä¸€å°éƒ¨åˆ†ç¥žç»å…ƒåœ¨å„ç§è¾“å…¥ä¸­æŒç»­è´¡çŒ®äº†å¤§éƒ¨åˆ†æ¿€æ´» (è¶…è¿‡80%ï¼Œçƒ­æ¿€æ´»)ï¼Œè€Œå¤§éƒ¨åˆ†ç¥žç»å…ƒå‚ä¸Žå‰©ä½™çš„æ¿€æ´»ï¼Œè¿™äº›æ¿€æ´»æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®è¾“å…¥ç¡®å®šçš„ (å†·æ¿€æ´»)ã€‚è¿™ä¸€è§‚å¯Ÿè¡¨æ˜ŽLLMsåœ¨é«˜æ¿€æ´»ç¨€ç–æ€§ä¸­å­˜åœ¨å›ºæœ‰çš„æ¿€æ´»å±€éƒ¨æ€§ï¼Œå¯ä»¥ç”¨æ¥è§£å†³å‰é¢æåˆ°çš„å±€éƒ¨æ€§ä¸åŒ¹é…é—®é¢˜ã€‚ 4. è®¾è®¡ åŸºäºŽè¿™ç§å±€éƒ¨æ€§è§‚å¯Ÿï¼Œæœ¬æ–‡æŽ¨å‡ºPowerInferã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯é€šè¿‡å°†å°‘é‡çƒ­ç¥žç»å…ƒåˆ†é…ç»™GPUï¼Œè€Œå°†æž„æˆå¤§å¤šæ•°çš„å†·ç¥žç»å…ƒç”±CPUç®¡ç†ï¼Œæ¥åˆ©ç”¨LLMæŽ¨ç†ä¸­çš„å±€éƒ¨æ€§ã€‚å…·ä½“æ¥è¯´ï¼ŒPowerInferé€šè¿‡ä¸¤æ­¥è¿‡ç¨‹æ¥åˆ©ç”¨LLMæŽ¨ç†ä¸­çš„å±€éƒ¨æ€§ï¼š åœ¨ç¦»çº¿é˜¶æ®µï¼ŒPowerInferåŸºäºŽç¥žç»å…ƒçš„ç»Ÿè®¡æ¿€æ´»é¢‘çŽ‡é¢„å…ˆåˆ†ç±»å‡ºçƒ­ç¥žç»å…ƒå’Œå†·ç¥žç»å…ƒï¼Œå¹¶å°†å®ƒä»¬åˆ†åˆ«é¢„åŠ è½½åˆ°GPUå’ŒCPUä¸Šã€‚ åœ¨è¿è¡Œæ—¶ï¼Œå®ƒä½¿ç”¨åœ¨çº¿é¢„æµ‹å™¨æ¥è¯†åˆ«å¯¹äºŽæ¯ä¸ªç‰¹å®šè¾“å…¥å¯èƒ½è¢«æ¿€æ´»çš„ç¥žç»å…ƒã€‚è¿™ç§æ–¹æ³•å…è®¸GPUå’ŒCPUç‹¬ç«‹å¤„ç†å®ƒä»¬å„è‡ªçš„æ¿€æ´»çš„ç¥žç»å…ƒï¼Œä»Žè€Œæœ€å°åŒ–PCIeæ•°æ®ä¼ è¾“ã€‚ 5. æµ‹è¯• å®žéªŒç»“æžœè¡¨æ˜Žï¼ŒPowerInferèƒ½å¤Ÿå®žçŽ°å¹³å‡7.23å€çš„åŠ é€Ÿæ¯”ï¼Œæœ€é«˜è¾¾11.69å€çš„åŠ é€Ÿã€‚è¿™ä¸»è¦å–å†³äºŽPowerInferèƒ½å¤Ÿè®©è¶…è¿‡80%çš„è®¡ç®—ç”±GPUæ¥æ‰¿æ‹…ï¼Œæ˜¾è‘—åœ°ç¼“è§£äº†å±€éƒ¨æ€§ä¸åŒ¹é…çš„é—®é¢˜ã€‚ 6. Q&A Q1: è¿™ç§æ¨¡åž‹çš„ç¨€ç–æ€§éœ€è¦finetuneæ¨¡åž‹å—ï¼Ÿ A1: æœ‰äº›æ¨¡åž‹å¤©ç„¶å­˜åœ¨è¿™æ ·çš„ç¨€ç–æ€§ï¼Œä¾‹å¦‚OPTï¼ŒNVIDIAæŽ¨å‡ºçš„Minitronï¼›æœ‰äº›æ¨¡åž‹åˆ™éœ€è¦è¿›è¡Œfinetuneä»¥æ¿€å‘å…¶ç¨€ç–æ€§ã€‚ Q2: çƒ­ç¥žç»å…ƒæ˜¯åªæœ‰ä¸€å±‚æœ‰çš„è¿˜æ˜¯æ‰€æœ‰å±‚éƒ½å­˜åœ¨ï¼Ÿ A2: ç¥žç»å…ƒçš„å†·çƒ­æ€§åœ¨æ•´ä¸ªæ¨¡åž‹ä¸­å­˜åœ¨ï¼Œå¹¶ä¸å±€é™äºŽä¸€å±‚ã€‚ "},"LLM/":{"url":"LLM/","title":"LLM","keywords":"","body":"LLM LLM Foundations NeurIPS17 - Attention is All You Need "},"LLM/LLMModels.html":{"url":"LLM/LLMModels.html","title":"LLM Foundations","keywords":"","body":"1. ä»€ä¹ˆæ˜¯Base/Chat/Instruct/4Bitæ¨¡åž‹ å¤§æ¨¡åž‹åº“ä¸­çš„Baseã€Chatã€Instructå’Œ4Bité€šå¸¸æŒ‡çš„æ˜¯ä¸åŒç±»åž‹æˆ–é…ç½®çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡åž‹ã€‚å®ƒä»¬çš„åŒºåˆ«ä¸»è¦åœ¨äºŽè®­ç»ƒç›®æ ‡ã€ç”¨é€”å’Œæ¨¡åž‹å‚æ•°çš„ç²¾åº¦ã€‚ Baseæ¨¡åž‹ (base) å®šä¹‰ï¼šBaseæ¨¡åž‹é€šå¸¸æ˜¯æŒ‡æœªç»ç‰¹å®šä»»åŠ¡å¾®è°ƒçš„åŸºç¡€é¢„è®­ç»ƒæ¨¡åž‹ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æœ€åˆè¢«å¼€å‘å’Œä¼˜åŒ–çš„ï¼Œå®ƒæ—¨åœ¨å¹³è¡¡æ€§èƒ½å’Œèµ„æºæ¶ˆè€—ï¼› ç”¨é€”ï¼šè¿™äº›æ¨¡åž‹é€šå¸¸ç”¨äºŽè¿›ä¸€æ­¥çš„å¾®è°ƒï¼Œä»¥é€‚åº”ç‰¹å®šä»»åŠ¡æˆ–åº”ç”¨åœºæ™¯ã€‚å¦‚ï¼šæ™ºèƒ½å¯¹è¯ã€æ–‡æœ¬å†…å®¹ç”Ÿæˆç­‰ï¼› ç‰¹ç‚¹ï¼šå®ƒä»¬åŒ…å«äº†å¤§é‡é€šç”¨çŸ¥è¯†ï¼Œä½†æ²¡æœ‰é’ˆå¯¹ç‰¹å®šä»»åŠ¡è¿›è¡Œä¼˜åŒ–ã€‚ Chatæ¨¡åž‹ (chat) å®šä¹‰ï¼šChatæ¨¡åž‹ä¸“é—¨ä¸ºå¯¹è¯ç³»ç»Ÿ (èŠå¤©æœºå™¨äºº)è®¾è®¡å’Œä¼˜åŒ–ï¼› ç”¨é€”ï¼šç”¨äºŽç”Ÿæˆè‡ªç„¶è¯­è¨€å¯¹è¯ï¼Œèƒ½å¤Ÿç†è§£ä¸Šä¸‹æ–‡å¹¶ç”Ÿæˆè¿žè´¯ä¸”æœ‰æ„ä¹‰çš„å›žå¤ã€‚å¦‚ï¼šèŠå¤©æœºå™¨äººã€æ™ºèƒ½åŠ©åŠ›ï¼› ç‰¹ç‚¹ï¼šé€šå¸¸ç»è¿‡å¤§é‡å¯¹è¯æ•°æ®å¾®è°ƒï¼Œå…·å¤‡æ›´å¥½çš„ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›å’Œå¯¹è¯ç”Ÿæˆèƒ½åŠ›ã€‚ Instructæ¨¡åž‹ (instruct) å®šä¹‰ï¼šInstructæ¨¡åž‹æ˜¯ä¸ºéµå¾ªæŒ‡ä»¤æˆ–å®Œæˆç‰¹å®šä»»åŠ¡è€Œè®¾è®¡å’Œä¼˜åŒ–çš„æ¨¡åž‹ï¼› ç”¨é€”ï¼šç”¨äºŽæ‰§è¡Œå…·ä½“æŒ‡ä»¤ï¼Œå¦‚å›žç­”é—®é¢˜ã€ç”Ÿæˆæ–‡æœ¬ã€ç¿»è¯‘ç­‰ä»»åŠ¡ï¼› ç‰¹ç‚¹ï¼šç»è¿‡æŒ‡ä»¤æ•°æ®é›†å¾®è°ƒï¼Œèƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œæ‰§è¡Œç”¨æˆ·æä¾›çš„æŒ‡ä»¤ã€‚ 4-Bitæ¨¡åž‹ (4bit) å®šä¹‰ï¼š4-Bitæ¨¡åž‹ä½¿ç”¨ä½Žç²¾åº¦ (4ä½)è¿›è¡Œé‡åŒ–ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨å’Œè®¡ç®—èµ„æºéœ€æ±‚ï¼› ç”¨é€”ï¼šé€‚ç”¨äºŽèµ„æºå—é™çš„çŽ¯å¢ƒï¼Œå¦‚ç§»åŠ¨è®¾å¤‡æˆ–åµŒå…¥å¼ç³»ç»Ÿï¼ŒåŒæ—¶ä¿æŒè¾ƒé«˜çš„æ€§èƒ½è¡¨çŽ°ï¼› ç‰¹ç‚¹ï¼šé€šè¿‡é‡åŒ–æŠ€æœ¯æ˜¾è‘—å‡å°‘äº†æ¨¡åž‹å¤§å°å’Œè®¡ç®—å¤æ‚åº¦ï¼Œä½†å¯èƒ½ä¼šç‰ºç‰²éƒ¨åˆ†ç²¾åº¦ã€‚ "},"LLM/neurips17-Transformer.html":{"url":"LLM/neurips17-Transformer.html","title":"NeurIPS17 - Transformer","keywords":"","body":"neurips17 - Transformer Attention is All You Need 1. å¼•è¨€ Transformeræ¨¡åž‹çš„å…¶ä¸­ä¸€ä¸ªä¼˜ç‚¹ï¼Œå°±æ˜¯ä½¿å¾—æ¨¡åž‹è®­ç»ƒè¿‡ç¨‹èƒ½å¤Ÿå¹¶è¡Œè®¡ç®—ã€‚åœ¨RNNä¸­ï¼Œæ¯ä¸€ä¸ªtime stepçš„è®¡ç®—éƒ½ä¾èµ–äºŽä¸Šä¸€ä¸ªtime stepçš„è¾“å‡ºï¼Œè¿™å°±ä½¿å¾—æ‰€æœ‰çš„time stepå¿…é¡»ä¸²è¡ŒåŒ–ï¼Œæ— æ³•å¹¶è¡Œè®¡ç®—ï¼›è€Œåœ¨Transformerä¸­ï¼Œæ‰€æœ‰time stepçš„æ•°æ®ï¼Œéƒ½æ˜¯ç»è¿‡Self Attentionè®¡ç®—ï¼Œä½¿å¾—æ•´ä¸ªè¿ç®—è¿‡ç¨‹å¯ä»¥å¹¶è¡ŒåŒ–è®¡ç®—ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Transformerä½¿ç”¨äº†Seq2Seqä»»åŠ¡ä¸­å¸¸ç”¨çš„ç»“æž„ -- åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šEncoderå’ŒDecoderï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2. ä»Žæ•´ä½“å®è§‚æ¥ç†è§£Transformer é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ•´ä¸ªæ¨¡åž‹è§†ä¸ºé»‘ç›’ã€‚åœ¨æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸­ï¼ŒæŽ¥æ”¶ä¸€ç§è¯­è¨€çš„å¥å­ä½œä¸ºè¾“å…¥ï¼Œç„¶åŽå°†å…¶ç¿»è¯‘æˆå…¶ä»–è¯­è¨€è¾“å‡ºã€‚ ä¸­é—´éƒ¨åˆ†çš„Transformerå¯ä»¥æ‹†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå·¦è¾¹æ˜¯ç¼–ç éƒ¨åˆ† (encoding component)ï¼Œå³è¾¹æ˜¯è§£ç éƒ¨åˆ† (decoding component)ã€‚ å…¶ä¸­ç¼–ç éƒ¨åˆ†æ˜¯å¤šå±‚çš„ç¼–ç å™¨ (Encoder)ç»„æˆ (Transformerçš„è®ºæ–‡ä¸­ä½¿ç”¨äº†6å±‚ç¼–ç å™¨ï¼Œè¿™é‡Œçš„å±‚æ•°6å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®žéªŒæ•ˆæžœæ¥ä¿®æ”¹å±‚æ•°)ã€‚åŒç†ï¼Œè§£ç éƒ¨åˆ†ä¹Ÿæ˜¯ç”±å¤šå±‚çš„è§£ç å™¨ (Decoder)ç»„æˆ (è®ºæ–‡é‡Œä¹Ÿä½¿ç”¨äº†6å±‚çš„è§£ç å™¨)ã€‚ æ¯ä¸€ä¸ªç¼–ç å™¨åœ¨ç»“æž„ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†å®ƒä»¬çš„æƒé‡å‚æ•°æ˜¯ä¸åŒçš„ã€‚æ¯ä¸€ä¸ªç¼–ç å™¨é‡Œé¢ï¼Œå¯ä»¥åˆ†ä¸º2å±‚ï¼š Self-Attention Layer Feed Forward Neural Network (å‰é¦ˆç¥žç»ç½‘ç»œï¼Œç¼©å†™ä¸ºFFNN) è¾“å…¥ç¼–ç å™¨çš„æ–‡æœ¬æ•°æ®ï¼Œé¦–å…ˆä¼šç»è¿‡ä¸€ä¸ªSelf Attentionå±‚ï¼Œè¿™ä¸ªå±‚åœ¨å¤„ç†ä¸€ä¸ªè¯çš„æ—¶å€™ï¼Œä¸ä»…ä¼šä½¿ç”¨è¿™ä¸ªè¯æœ¬èº«çš„ä¿¡æ¯ï¼Œä¹Ÿä¼šä½¿ç”¨å¥å­ä¸­å…¶ä»–è¯çš„ä¿¡æ¯ã€‚æŽ¥ä¸‹æ¥ï¼ŒSelf Attentionå±‚çš„è¾“å‡ºä¼šç»è¿‡å‰é¦ˆç¥žç»ç½‘ç»œã€‚åŒç†ï¼Œè§£ç å™¨ä¹Ÿæœ‰è¿™ä¸¤å±‚ï¼Œä½†æ˜¯è¿™ä¸¤å±‚ä¸­é—´è¿˜æ’å…¥äº†ä¸€ä¸ªEncoder-Decoder Attentionå±‚ï¼Œè¿™ä¸ªå±‚èƒ½å¸®åŠ©è§£ç å™¨èšç„¦äºŽè¾“å…¥å¥å­çš„ç›¸å…³éƒ¨åˆ†ã€‚ 3. ä»Žç»†èŠ‚æ¥ç†è§£Transformer 3.1 Transformerçš„è¾“å…¥ å’Œé€šå¸¸çš„NLPä»»åŠ¡ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šä½¿ç”¨è¯åµŒå…¥ç®—æ³• (embedding algorithm)ï¼Œå°†æ¯ä¸ªè¯è½¬æ¢ä¸ºä¸€ä¸ªè¯å‘é‡ã€‚å®žé™…ä¸­å‘é‡ä¸€èˆ¬æ˜¯256æˆ–è€…512ç»´ã€‚ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œè¿™é‡Œå°†æ¯ä¸ªè¯çš„è½¬æ¢ä¸ºä¸€ä¸ª4ç»´çš„è¯å‘é‡ã€‚ é‚£ä¹ˆæ•´ä¸ªè¾“å…¥çš„å¥å­æ˜¯ä¸€ä¸ªå‘é‡åˆ—è¡¨ï¼Œå…¶ä¸­æœ‰3ä¸ªè¯å‘é‡ã€‚åœ¨å®žé™…ä¸­ï¼Œæ¯ä¸ªå¥å­çš„é•¿åº¦ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¼šå–ä¸€ä¸ªé€‚å½“çš„å€¼ï¼Œä½œä¸ºå‘é‡åˆ—è¡¨çš„é•¿åº¦ã€‚å¦‚æžœä¸€ä¸ªå¥å­è¾¾ä¸åˆ°è¿™ä¸ªé•¿åº¦ï¼Œé‚£ä¹ˆå°±å¡«å……å…¨ä¸º0çš„è¯å‘é‡ï¼›å¦‚æžœå¥å­è¶…å‡ºè¿™ä¸ªé•¿åº¦ï¼Œåˆ™åšæˆªæ–­ã€‚å¥å­é•¿åº¦æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œé€šå¸¸æ˜¯è®­ç»ƒé›†ä¸­çš„å¥å­çš„æœ€å¤§é•¿åº¦ã€‚ ç¼–ç å™¨ (Encoder)æŽ¥æ”¶çš„è¾“å…¥éƒ½æ˜¯ä¸€ä¸ªå‘é‡åˆ—è¡¨ï¼Œè¾“å‡ºä¹Ÿæ˜¯å¤§å°åŒæ ·çš„å‘é‡åˆ—è¡¨ï¼Œç„¶åŽæŽ¥ç€è¾“å…¥ä¸‹ä¸€ä¸ªç¼–ç å™¨ã€‚ ç¬¬ä¸€ä¸ªç¼–ç å™¨çš„è¾“å…¥æ˜¯è¯å‘é‡ï¼Œè€ŒåŽé¢çš„ç¼–ç å™¨çš„è¾“å…¥æ˜¯ä¸Šä¸€ä¸ªç¼–ç å™¨çš„è¾“å‡ºã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°Transformerçš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šæ¯ä¸ªä½ç½®çš„è¯å‘é‡ç»è¿‡ç¼–ç å™¨éƒ½æœ‰è‡ªå·±å•ç‹¬çš„è·¯å¾„ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨Self Attentionå±‚ä¸­ï¼Œè¿™äº›è·¯å¾„ä¹‹é—´æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼›è€Œåœ¨Feed Forward (å‰é¦ˆç¥žç»ç½‘ç»œ)å±‚ä¸­ï¼Œè¿™äº›è·¯å¾„ä¹‹é—´æ˜¯æ²¡æœ‰ä¾èµ–å…³ç³»çš„ã€‚å› æ­¤è¿™äº›è¯å‘é‡åœ¨ç»è¿‡Feed Forwardå±‚ä¸­å¯ä»¥å¹¶è¡Œè®¡ç®—ã€‚ 3.2 Encoder (ç¼–ç å™¨) ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œä¸€ä¸ªç¼–ç å™¨æŽ¥æ”¶çš„è¾“å…¥æ˜¯ä¸€ä¸ªå‘é‡åˆ—è¡¨ï¼Œå®ƒä¼šæŠŠå‘é‡åˆ—è¡¨è¾“å…¥åˆ°Self Attentionå±‚ï¼Œç„¶åŽç»è¿‡feed-forward neural network (å‰é¦ˆç¥žç»ç½‘ç»œ)å±‚ï¼Œæœ€åŽå¾—åˆ°è¾“å‡ºï¼Œä¼ å…¥ä¸‹ä¸€ä¸ªç¼–ç å™¨ã€‚ æ¯ä¸ªä½ç½®çš„è¯éƒ½ç»è¿‡Self Attentionå±‚ï¼Œå¾—åˆ°çš„æ¯ä¸ªè¾“å‡ºå‘é‡éƒ½å•ç‹¬ç»è¿‡å‰é¦ˆç¥žç»ç½‘ç»œå±‚ï¼Œæ¯ä¸ªå‘é‡ç»è¿‡çš„å‰é¦ˆç¥žç»ç½‘ç»œéƒ½æ˜¯ä¸€æ ·çš„ã€‚ 4. Self-Attentionæ•´ä½“ç†è§£ ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦ç¿»è¯‘çš„å¥å­æ˜¯ï¼šThe animal didn't cross the street because it was too tired. è¿™ä¸ªå¥å­ä¸­çš„itæ˜¯ä¸€ä¸ªæŒ‡ä»£è¯ï¼Œé‚£ä¹ˆitæŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒæ˜¯æŒ‡animalè¿˜æ˜¯streetï¼Ÿè¿™ä¸ªé—®é¢˜å¯¹äººæ¥è¯´ï¼Œæ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å¯¹ç®—æ³•æ¥è¯´å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚å½“æ¨¡åž‹åœ¨å¤„ç† (ç¿»è¯‘)itçš„æ—¶å€™ï¼ŒSelf Attentionæœºåˆ¶èƒ½å¤Ÿè®©æ¨¡åž‹æŠŠitå’Œanimalå…³è”èµ·æ¥ã€‚ åŒç†ï¼Œå½“æ¨¡åž‹å¤„ç†å¥å­ä¸­çš„æ¯ä¸ªè¯æ—¶ï¼ŒSelf Attentionæœºåˆ¶ä½¿å¾—æ¨¡åž‹ä¸ä»…èƒ½å¤Ÿå…³æ³¨è¿™ä¸ªä½ç½®çš„è¯ï¼Œè€Œä¸”èƒ½å¤Ÿå…³æ³¨å¥å­ä¸­å…¶ä»–ä½ç½®çš„è¯ï¼Œä½œä¸ºè¾…åŠ©çº¿ç´¢ï¼Œè¿›è€Œå¯ä»¥æ›´å¥½åœ°ç¼–ç å½“å‰ä½ç½®çš„è¯ã€‚ ç›¸åï¼šRNNåœ¨å¤„ç†ä¸€ä¸ªè¯æ—¶ï¼Œä¼šè€ƒè™‘å‰é¢ä¼ è¿‡æ¥çš„hidden stateï¼Œè€Œhidden stateå°±åŒ…å«äº†å‰é¢çš„è¯çš„ä¿¡æ¯ã€‚è€ŒTransformerä½¿ç”¨Self Attentionæœºåˆ¶ï¼Œä¼šæŠŠå…¶ä»–å•è¯çš„ç†è§£èžå…¥å¤„ç†å½“å‰çš„å•è¯ã€‚å¦‚ä¸‹å›¾ï¼š 5. Self-Attentionçš„ç»†èŠ‚ 5.1 è®¡ç®—Queryå‘é‡ã€Keyå‘é‡ã€Valueå‘é‡ ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸‹å¦‚ä½•ä½¿ç”¨å‘é‡æ¥è®¡ç®—Self Attentionï¼Œç„¶åŽå†çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨çŸ©é˜µæ¥å®žçŽ°Self Attention (çŸ©é˜µè¿ç®—çš„æ–¹å¼ï¼Œä½¿å¾—Self Attentionçš„è®¡ç®—èƒ½å¤Ÿå¹¶è¡ŒåŒ–ï¼Œè¿™ä¹Ÿæ˜¯Self Attentionæœ€ç»ˆçš„å®žçŽ°æ–¹å¼)ã€‚ è®¡ç®—Self Attentionçš„ç¬¬1æ­¥æ˜¯ï¼šå¯¹è¾“å…¥ç¼–ç å™¨çš„æ¯ä¸ªè¯å‘é‡ï¼Œéƒ½åˆ›å»º3ä¸ªå‘é‡ï¼Œåˆ†åˆ«æ˜¯ï¼šQueryå‘é‡ï¼ŒKeyå‘é‡ï¼ŒValueå‘é‡ã€‚è¿™3ä¸ªå‘é‡æ˜¯è¯å‘é‡åˆ†åˆ«å’Œ3ä¸ªçŸ©é˜µç›¸ä¹˜å¾—åˆ°çš„ï¼Œè€Œè¿™ä¸ªçŸ©é˜µæ˜¯æˆ‘ä»¬è¦å­¦ä¹ çš„å‚æ•°ã€‚ æ³¨æ„ï¼Œè¿™3ä¸ªæ–°å¾—åˆ°çš„å‘é‡ä¸€èˆ¬æ¯”åŽŸæ¥çš„è¯å‘é‡çš„é•¿åº¦æ›´å°ã€‚ 5.2 è®¡ç®—Attention Score (æ³¨æ„åŠ›åˆ†æ•°) ç¬¬2æ­¥ï¼Œæ˜¯è®¡ç®—Attention Score (æ³¨æ„åŠ›åˆ†æ•°)ã€‚å‡è®¾æˆ‘ä»¬çŽ°åœ¨è®¡ç®—ç¬¬ä¸€ä¸ªè¯Thinkingçš„Attention Score (æ³¨æ„åŠ›åˆ†æ•°)ï¼Œéœ€è¦æ ¹æ®Thinkingè¿™ä¸ªè¯ï¼Œå¯¹å¥å­ä¸­çš„å…¶ä»–æ¯ä¸ªè¯éƒ½è®¡ç®—ä¸€ä¸ªåˆ†æ•°ã€‚è¿™äº›åˆ†æ•°å†³å®šäº†æˆ‘ä»¬åœ¨ç¼–ç Thinkingè¿™ä¸ªè¯æ—¶ï¼Œéœ€è¦å¯¹å¥å­ä¸­å…¶ä»–ä½ç½®çš„æ¯ä¸ªè¯æ”¾ç½®å¤šå°‘çš„æ³¨æ„åŠ›ã€‚ è¿™äº›åˆ†æ•°ï¼Œæ˜¯é€šè¿‡è®¡ç®—Thinkingå¯¹åº”çš„Queryå‘é‡å’Œå…¶ä»–ä½ç½®çš„æ¯ä¸ªè¯çš„Keyå‘é‡çš„ç‚¹ç§¯è€Œå¾—åˆ°çš„ã€‚å¦‚æžœæˆ‘ä»¬è®¡ç®—å¥å­ä¸­ç¬¬ä¸€ä¸ªä½ç½®å•è¯çš„Attention Score (æ³¨æ„åŠ›åˆ†æ•°)ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªåˆ†æ•°å°±æ˜¯q1å’Œk1çš„å†…ç§¯ï¼Œç¬¬äºŒä¸ªåˆ†æ•°å°±æ˜¯q1å’Œk2çš„ç‚¹ç§¯ã€‚ ç¬¬3æ­¥å°±æ˜¯æŠŠæ¯ä¸ªåˆ†æ•°é™¤ä»¥æŸä¸ªæ•°ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨åå‘ä¼ æ’­æ—¶ï¼Œæ±‚å–æ¢¯åº¦æ›´åŠ ç¨³å®šã€‚ ç¬¬4æ­¥ï¼ŒæŽ¥ç€æŠŠè¿™äº›åˆ†æ•°ç»è¿‡ä¸€ä¸ªSoftmaxå±‚ï¼ŒSoftmaxå¯ä»¥å°†åˆ†æ•°å½’ä¸€åŒ–ï¼Œè¿™æ ·ä½¿å¾—åˆ†æ•°éƒ½æ˜¯æ­£æ•°å¹¶ä¸”åŠ èµ·æ¥ç­‰äºŽ1ã€‚ è¿™äº›åˆ†æ•°å†³å®šäº†åœ¨ç¼–ç å½“å‰ä½ç½®çš„è¯æ—¶ï¼Œå¯¹æ‰€æœ‰ä½ç½®çš„è¯åˆ†åˆ«æœ‰å¤šå°‘çš„æ³¨æ„åŠ›ã€‚å¾ˆæ˜Žæ˜¾ï¼Œåœ¨ä¸Šå›¾çš„ä¾‹å­ä¸­ï¼Œå½“å‰ä½ç½®çš„è¯ä¼šæœ‰æœ€é«˜çš„åˆ†æ•°ï¼Œä½†æœ‰æ—¶ï¼Œå…³æ³¨åˆ°å…¶ä»–ä½ç½®ä¸Šç›¸å…³çš„è¯ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ ç¬¬5æ­¥ï¼Œå¾—åˆ°æ¯ä¸ªä½ç½®çš„åˆ†æ•°åŽï¼Œå°†æ¯ä¸ªåˆ†æ•°åˆ†åˆ«ä¸Žæ¯ä¸ªValueå‘é‡ç›¸ä¹˜ã€‚è¿™ç§åšæ³•èƒŒåŽçš„ç›´è§‰ç†è§£å°±æ˜¯ï¼šå¯¹äºŽåˆ†æ•°é«˜çš„ä½ç½®ï¼Œç›¸ä¹˜åŽçš„å€¼å°±è¶Šå¤§ï¼Œæˆ‘ä»¬æŠŠæ›´å¤šçš„æ³¨æ„åŠ›æ”¾åˆ°äº†å®ƒä»¬èº«ä¸Šï¼›å¯¹äºŽåˆ†æ•°ä½Žçš„ä½ç½®ï¼Œç›¸ä¹˜åŽçš„å€¼å°±è¶Šå°ï¼Œè¿™äº›ä½ç½®çš„è¯å¯èƒ½æ˜¯ç›¸å…³æ€§ä¸å¤§çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¿½ç•¥äº†è¿™äº›ä½ç½®çš„è¯ã€‚ ç¬¬6æ­¥æ˜¯æŠŠä¸Šä¸€æ­¥å¾—åˆ°çš„å‘é‡ç›¸åŠ ï¼Œå°±å¾—åˆ°äº†Self Attentionå±‚åœ¨è¿™ä¸ªä½ç½®çš„è¾“å‡ºã€‚ ä¸Šé¢è¿™å¼ å›¾ï¼ŒåŒ…å«äº†Self Attentionçš„å…¨è¿‡ç¨‹ï¼Œæœ€ç»ˆå¾—åˆ°çš„å½“å‰ä½ç½®çš„å‘é‡ä¼šè¾“å…¥åˆ°å‰é¦ˆç¥žç»ç½‘ç»œã€‚ä½†è¿™æ ·æ¯æ¬¡åªèƒ½è®¡ç®—ä¸€ä¸ªä½ç½®çš„è¾“å‡ºå‘é‡ï¼Œåœ¨å®žé™…çš„ä»£ç å®žçŽ°ä¸­ï¼ŒSelf Attention çš„è®¡ç®—è¿‡ç¨‹æ˜¯ä½¿ç”¨çŸ©é˜µæ¥å®žçŽ°çš„ï¼Œè¿™æ ·å¯ä»¥åŠ é€Ÿè®¡ç®—ï¼Œä¸€æ¬¡å°±å¾—åˆ°æ‰€æœ‰ä½ç½®çš„è¾“å‡ºå‘é‡ã€‚ 6. ä½¿ç”¨çŸ©é˜µè®¡ç®—Self-Attention ç¬¬ä¸€æ­¥æ˜¯è®¡ç®—Queryï¼ŒKeyï¼ŒValueçš„çŸ©é˜µã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰è¯å‘é‡æ”¾åˆ°ä¸€ä¸ªçŸ©é˜µXä¸­ï¼Œç„¶åŽåˆ†åˆ«å’Œ3ä¸ªæƒé‡çŸ©é˜µç›¸ä¹˜ï¼Œå¾—åˆ°Qï¼ŒKï¼ŒVçŸ©é˜µã€‚ æŽ¥ç€ï¼Œç”±äºŽæˆ‘ä»¬ä½¿ç”¨äº†çŸ©é˜µæ¥è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ç¬¬2æ­¥åˆ°ç¬¬6æ­¥åŽ‹ç¼©ä¸ºä¸€æ­¥ï¼Œç›´æŽ¥å¾—åˆ°Self Attentionçš„è¾“å‡ºã€‚ 7. å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ Transformerçš„è®ºæ–‡é€šè¿‡å¢žåŠ å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ (ä¸€ç»„æ³¨æ„åŠ›ç§°ä¸ºä¸€ä¸ªattention head)ï¼Œè¿›ä¸€æ­¥å®Œå–„äº†Self Attentionå±‚ã€‚è¿™ç§æœºåˆ¶ä»Žå¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢å¢žå¼ºäº†attentionå±‚çš„èƒ½åŠ›ï¼š å®ƒæ‰©å±•äº†æ¨¡åž‹å…³æ³¨ä¸åŒä½ç½®çš„èƒ½åŠ›ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªä½ç½®çš„è¾“å‡ºz1åŒ…å«äº†å¥å­ä¸­å…¶ä»–æ¯ä¸ªä½ç½®çš„å¾ˆå°ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼Œä½†z1å¯èƒ½ä¸»è¦æ˜¯ç”±ç¬¬ä¸€ä¸ªä½ç½®çš„ä¿¡æ¯å†³å®šçš„ã€‚å½“æˆ‘ä»¬ç¿»è¯‘å¥å­ï¼šThe animal didn't cross the street because it was too tiredæ—¶ï¼Œæˆ‘ä»¬æƒ³è®©æœºå™¨çŸ¥é“å…¶ä¸­çš„itæŒ‡ä»£çš„æ˜¯ä»€ä¹ˆã€‚è¿™æ—¶ï¼Œå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¼šæœ‰å¸®åŠ©ã€‚ å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶èµ‹äºˆattentionå±‚å¤šä¸ª\"å­è¡¨ç¤ºç©ºé—´\"ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¼šæœ‰å¤šç»„çš„æƒé‡çŸ©é˜µ (åœ¨Transformerçš„è®ºæ–‡ä¸­ï¼Œä½¿ç”¨äº†8ç»„æ³¨æ„åŠ› (attention heads))ã€‚æ¯ä¸€ç»„æ³¨æ„åŠ›çš„çš„æƒé‡çŸ©é˜µéƒ½æ˜¯éšæœºåˆå§‹åŒ–çš„ã€‚ç»è¿‡è®­ç»ƒä¹‹åŽï¼Œæ¯ä¸€ç»„æ³¨æ„åŠ›å¯ä»¥çœ‹ä½œæ˜¯æŠŠè¾“å…¥çš„å‘é‡æ˜ å°„åˆ°ä¸€ä¸ª\"å­è¡¨ç¤ºç©ºé—´\"ã€‚ æŽ¥ç€ï¼Œæˆ‘ä»¬æŠŠæ¯ç»„Kã€Qã€Vè®¡ç®—å¾—åˆ°æ¯ç»„çš„ZçŸ©é˜µï¼Œå°±å¾—åˆ°8ä¸ªZçŸ©é˜µã€‚ æŽ¥ä¸‹æ¥å°±æœ‰ç‚¹éº»çƒ¦äº†ï¼Œå› ä¸ºå‰é¦ˆç¥žç»ç½‘ç»œå±‚æŽ¥æ”¶çš„æ˜¯1ä¸ªçŸ©é˜µ (å…¶ä¸­æ¯è¡Œçš„å‘é‡è¡¨ç¤ºä¸€ä¸ªè¯)ï¼Œè€Œä¸æ˜¯8ä¸ªçŸ©é˜µã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼ŒæŠŠ8ä¸ªçŸ©é˜µæ•´åˆä¸ºä¸€ä¸ªçŸ©é˜µã€‚ æ€Žä¹ˆæ‰èƒ½åšåˆ°å‘¢ï¼Ÿæˆ‘ä»¬æŠŠçŸ©é˜µæ‹¼æŽ¥èµ·æ¥ï¼Œç„¶åŽå’Œå¦ä¸€ä¸ªæƒé‡çŸ©é˜µç›¸ä¹˜ã€‚ 8. ä½¿ç”¨ä½ç½®ç¼–ç æ¥è¡¨ç¤ºåºåˆ—çš„é¡ºåº åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é˜è¿°çš„æ¨¡åž‹ä¸­ç¼ºå¤±äº†ä¸€ä¸ªä¸œè¥¿ï¼Œé‚£å°±æ˜¯è¡¨ç¤ºåºåˆ—ä¸­å•è¯é¡ºåºçš„æ–¹æ³•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTransformeræ¨¡åž‹å¯¹æ¯ä¸ªè¾“å…¥çš„å‘é‡éƒ½æ·»åŠ äº†ä¸€ä¸ªå‘é‡ã€‚è¿™äº›å‘é‡éµå¾ªæ¨¡åž‹å­¦ä¹ åˆ°çš„ç‰¹å®šæ¨¡å¼ï¼Œæœ‰åŠ©äºŽç¡®å®šæ¯ä¸ªå•è¯çš„ä½ç½®ï¼Œæˆ–è€…å¥å­ä¸­ä¸åŒå•è¯ä¹‹é—´çš„è·ç¦»ã€‚è¿™ç§åšæ³•èƒŒåŽçš„ç›´è§‰æ˜¯ï¼šå°†è¿™äº›è¡¨ç¤ºä½ç½®çš„å‘é‡æ·»åŠ åˆ°è¯å‘é‡ä¸­ï¼Œå¾—åˆ°äº†æ–°çš„å‘é‡ï¼Œè¿™äº›æ–°å‘é‡æ˜ å°„åˆ°Q/K/Vï¼Œç„¶åŽè®¡ç®—ç‚¹ç§¯å¾—åˆ°attentionæ—¶ï¼Œå¯ä»¥æä¾›æœ‰æ„ä¹‰çš„ä¿¡æ¯ã€‚ 9. æ®‹å·®è¿žæŽ¥ ç¼–ç å™¨ç»“æž„ä¸­æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç»†èŠ‚æ˜¯ï¼šç¼–ç å™¨çš„æ¯ä¸ªå­å±‚ (Self Attentionå±‚å’ŒFFNN)éƒ½æœ‰ä¸€ä¸ªæ®‹å·®è¿žæŽ¥å’Œå±‚æ ‡å‡†åŒ– (layer-normalization)ã€‚ åœ¨è§£ç å™¨çš„å­å±‚é‡Œé¢ä¹Ÿæœ‰å±‚æ ‡å‡†åŒ– (layer-normalization)ã€‚ 10. Decoder (è§£ç å™¨) ç¼–ç å™¨ä¸€èˆ¬æœ‰å¤šå±‚ï¼Œç¬¬ä¸€ä¸ªç¼–ç å™¨çš„è¾“å…¥æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œæœ€åŽä¸€ä¸ªç¼–ç å™¨è¾“å‡ºæ˜¯ä¸€ç»„æ³¨æ„åŠ›å‘é‡Kå’ŒVã€‚è¿™äº›æ³¨æ„åŠ›å‘é‡å°†ä¼šè¾“å…¥åˆ°æ¯ä¸ªè§£ç å™¨çš„Encoder-Decoder Attentionå±‚ï¼Œè¿™æœ‰åŠ©äºŽè§£ç å™¨æŠŠæ³¨æ„åŠ›é›†ä¸­è¾“å…¥åºåˆ—çš„åˆé€‚ä½ç½®ã€‚ åœ¨å®Œæˆäº†ç¼–ç  (encoding)é˜¶æ®µä¹‹åŽï¼Œæˆ‘ä»¬å¼€å§‹è§£ç  (decoding)é˜¶æ®µã€‚è§£ç  (decoding)é˜¶æ®µçš„æ¯ä¸€ä¸ªæ—¶é—´æ­¥éƒ½è¾“å‡ºä¸€ä¸ªç¿»è¯‘åŽçš„å•è¯ã€‚ æŽ¥ä¸‹æ¥ä¼šé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°è¾“å‡ºä¸€ä¸ªç»“æŸç¬¦ï¼ŒTransformerå°±å®Œæˆäº†æ‰€æœ‰çš„è¾“å‡ºã€‚æ¯ä¸€æ­¥çš„è¾“å‡ºéƒ½ä¼šåœ¨ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥è¾“å…¥åˆ°ä¸‹é¢çš„ç¬¬ä¸€ä¸ªè§£ç å™¨ã€‚Decoderå°±åƒEncoderé‚£æ ·ï¼Œä»Žä¸‹å¾€ä¸Šä¸€å±‚ä¸€å±‚åœ°è¾“å‡ºç»“æžœã€‚æ­£å¯¹å¦‚ç¼–ç å™¨çš„è¾“å…¥æ‰€åšçš„å¤„ç†ï¼Œæˆ‘ä»¬æŠŠè§£ç å™¨çš„è¾“å…¥å‘é‡ï¼Œä¹ŸåŠ ä¸Šä½ç½®ç¼–ç å‘é‡ï¼Œæ¥æŒ‡ç¤ºæ¯ä¸ªè¯çš„ä½ç½®ã€‚ è§£ç å™¨ä¸­çš„Self Attentionå±‚ï¼Œå’Œç¼–ç å™¨ä¸­çš„Self Attentionå±‚ä¸å¤ªä¸€æ ·ï¼šåœ¨è§£ç å™¨é‡Œï¼ŒSelf Attentionå±‚åªå…è®¸å…³æ³¨åˆ°è¾“å‡ºåºåˆ—ä¸­æ—©äºŽå½“å‰ä½ç½®ä¹‹å‰çš„å•è¯ã€‚å…·ä½“åšæ³•æ˜¯ï¼šåœ¨Self Attentionåˆ†æ•°ç»è¿‡Softmaxå±‚ä¹‹å‰ï¼Œå±è”½å½“å‰ä½ç½®ä¹‹åŽçš„é‚£äº›ä½ç½®ã€‚ Decoder Attentionå±‚çš„åŽŸç†å’Œå¤šå¤´æ³¨æ„åŠ› (MultiHeaded Self Attention)æœºåˆ¶ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„æ˜¯ï¼šDecoder Attentionå±‚æ˜¯ä½¿ç”¨å‰ä¸€å±‚çš„è¾“å‡ºæ¥æž„é€ QueryçŸ©é˜µï¼Œè€ŒKeyçŸ©é˜µå’ŒValueçŸ©é˜µæ¥è‡ªäºŽç¼–ç å™¨ (Encoder)æœ€ç»ˆçš„è¾“å‡ºã€‚ 11. æœ€åŽçš„çº¿æ€§å±‚å’ŒSoftmaxå±‚ Decoderæœ€ç»ˆçš„è¾“å‡ºæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯æµ®ç‚¹æ•°ã€‚æˆ‘ä»¬æ€Žä¹ˆæŠŠè¿™ä¸ªå‘é‡è½¬æ¢ä¸ºå•è¯å‘¢ï¼Ÿè¿™æ˜¯ç”±Softmaxå±‚åŽé¢çš„çº¿æ€§å±‚æ¥å®Œæˆçš„ã€‚ çº¿æ€§å±‚å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å…¨è¿žæŽ¥ç¥žç»ç½‘ç»œï¼Œå¯ä»¥æŠŠè§£ç å™¨è¾“å‡ºçš„å‘é‡ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªæ›´é•¿çš„å‘é‡ï¼Œè¿™ä¸ªå‘é‡ç§°ä¸ºlogitså‘é‡ã€‚çŽ°åœ¨å‡è®¾æˆ‘ä»¬çš„æ¨¡åž‹æœ‰10000ä¸ªè‹±è¯­å•è¯ (æ¨¡åž‹çš„è¾“å‡ºè¯æ±‡è¡¨)ï¼Œè¿™äº›å•è¯æ˜¯ä»Žè®­ç»ƒé›†ä¸­å­¦åˆ°çš„ã€‚å› æ­¤logitså‘é‡æœ‰ 10000 ä¸ªæ•°å­—ï¼Œæ¯ä¸ªæ•°è¡¨ç¤ºä¸€ä¸ªå•è¯çš„åˆ†æ•°ã€‚æˆ‘ä»¬å°±æ˜¯è¿™æ ·åŽ»ç†è§£çº¿æ€§å±‚çš„è¾“å‡ºã€‚ ç„¶åŽï¼ŒSoftmaxå±‚ä¼šæŠŠè¿™äº›åˆ†æ•°è½¬æ¢ä¸ºæ¦‚çŽ‡ (æŠŠæ‰€æœ‰çš„åˆ†æ•°è½¬æ¢ä¸ºæ­£æ•°ï¼Œå¹¶ä¸”åŠ èµ·æ¥ç­‰äºŽ1)ã€‚ç„¶åŽé€‰æ‹©æœ€é«˜æ¦‚çŽ‡çš„é‚£ä¸ªæ•°å­—å¯¹åº”çš„è¯ï¼Œå°±æ˜¯è¿™ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºå•è¯ã€‚ "},"Lover/":{"url":"Lover/","title":"My Lover","keywords":"","body":" æˆ‘æ„¿æ„åœ¨æœ‰é™çš„æ—¶é—´é‡Œæ— é™çš„çˆ±ç€ä½ ã€‚ /* å¤´åƒå¤§å°è°ƒæ•´ */ .avatar { width: 80px; /* å¤´åƒå®½åº¦ */ height: 80px; /* å¤´åƒé«˜åº¦ */ vertical-align: -20px; border-radius: 50%; margin-right: 5px; margin-bottom: 5px; -webkit-box-shadow: 1px 1px 1px rgba(0,0,0,.1), 1px 1px 1px rgba(0,0,0,0.1), 1px 1px 1px rgba(0,0,0,0.1); box-shadow: 1px 1px 1px rgba(0,0,0,.1), 1px 1px 1px rgba(0,0,0,0.1), 1px 1px 1px rgba(0,0,0,0.1); border: 2px solid #fff; } function timing() { // å¼€å§‹æ—¶é—´ - æ ¼å¼: å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’ let start = '2021-9-3 00:00:00' let startTime = new Date(start).getTime() let currentTime = new Date().getTime() let difference = currentTime - startTime let m = Math.floor(difference / (1000)) let mm = m % 60 // ç§’ let f = Math.floor(m / 60) let ff = f % 60 // åˆ†é’Ÿ let s = Math.floor(f / 60) // å°æ—¶ let ss = s % 24 let day = Math.floor(s / 24 ) // å¤©æ•° return \" \" + day + \" day \" + ss + \" h \" + ff + \" m \" + mm +' s' } setInterval(()=>{ document.getElementById('Timing').innerHTML = timing() }, 1000) --> "},"Friends/":{"url":"Friends/","title":"My Friends","keywords":"","body":"My Friends "}}